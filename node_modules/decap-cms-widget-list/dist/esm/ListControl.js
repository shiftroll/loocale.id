"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _core = require("@emotion/core");
var _styledBase = _interopRequireDefault(require("@emotion/styled-base"));
var _uniqueId2 = _interopRequireDefault(require("lodash/uniqueId"));
var _isEmpty2 = _interopRequireDefault(require("lodash/isEmpty"));
var _partial2 = _interopRequireDefault(require("lodash/partial"));
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _reactImmutableProptypes = _interopRequireDefault(require("react-immutable-proptypes"));
var _immutable = require("immutable");
var _v = _interopRequireDefault(require("uuid/v4"));
var _decapCmsWidgetObject = _interopRequireDefault(require("decap-cms-widget-object"));
var _core2 = require("@dnd-kit/core");
var _sortable = require("@dnd-kit/sortable");
var _modifiers = require("@dnd-kit/modifiers");
var _utilities = require("@dnd-kit/utilities");
var _decapCmsUiDefault = require("decap-cms-ui-default");
var _decapCmsLibWidgets = require("decap-cms-lib-widgets");
var _typedListHelpers = require("./typedListHelpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _EMOTION_STRINGIFIED_CSS_ERROR__() { return "You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop)."; }
const ObjectControl = _decapCmsWidgetObject.default.controlComponent;
const ListItem = (0, _styledBase.default)("div", {
  target: "e11zrb3c0",
  label: "ListItem"
})(process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFzQ2lCIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */");
const StyledListItemTopBar = ( /*#__PURE__*/0, _styledBase.default)(_decapCmsUiDefault.ListItemTopBar, {
  target: "e11zrb3c1",
  label: "StyledListItemTopBar"
})("background-color:", _decapCmsUiDefault.colors.textFieldBorder, ";" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3Q21EIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */"));
const NestedObjectLabel = (0, _styledBase.default)("div", {
  target: "e11zrb3c2",
  label: "NestedObjectLabel"
})("display:", props => props.collapsed ? 'block' : 'none', ";border-top:0;color:", props => props.error ? _decapCmsUiDefault.colors.errorText : 'inherit', ";background-color:", _decapCmsUiDefault.colors.textFieldBorder, ";padding:13px;border-radius:0 0 ", _decapCmsUiDefault.lengths.borderRadius, " ", _decapCmsUiDefault.lengths.borderRadius, ";" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0Q29DIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */"));
const styleStrings = {
  collapsedObjectControl: `
    display: none;
  `,
  objectWidgetTopBarContainer: `
    padding: ${_decapCmsUiDefault.lengths.objectWidgetTopBarContainerPadding};
  `
};
const styles = {
  listControlItem: process.env.NODE_ENV === "production" ? {
    name: "1pb8r5b-listControlItem",
    styles: "margin-top:18px;&:first-of-type{margin-top:26px;};label:listControlItem;"
  } : {
    name: "1pb8r5b-listControlItem",
    styles: "margin-top:18px;&:first-of-type{margin-top:26px;};label:listControlItem;",
    map: "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUErRHNCIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */",
    toString: _EMOTION_STRINGIFIED_CSS_ERROR__
  },
  listControlItemCollapsed: process.env.NODE_ENV === "production" ? {
    name: "1u3t54p-listControlItemCollapsed",
    styles: "padding-bottom:0;;label:listControlItemCollapsed;"
  } : {
    name: "1u3t54p-listControlItemCollapsed",
    styles: "padding-bottom:0;;label:listControlItemCollapsed;",
    map: "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFzRStCIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */",
    toString: _EMOTION_STRINGIFIED_CSS_ERROR__
  }
};
function SortableList({
  items,
  children,
  onSortEnd,
  keys
}) {
  const activationConstraint = {
    distance: 4
  };
  const sensors = (0, _core2.useSensors)((0, _core2.useSensor)(_core2.MouseSensor, {
    activationConstraint
  }), (0, _core2.useSensor)(_core2.TouchSensor, {
    activationConstraint
  }));
  function handleSortEnd({
    active,
    over
  }) {
    onSortEnd({
      oldIndex: keys.indexOf(active.id),
      newIndex: keys.indexOf(over.id)
    });
  }
  return (0, _core.jsx)("div", null, (0, _core.jsx)(_core2.DndContext, {
    modifiers: [_modifiers.restrictToParentElement],
    collisionDetection: _core2.closestCenter,
    sensors: sensors,
    onDragEnd: handleSortEnd
  }, (0, _core.jsx)(_sortable.SortableContext, {
    items: items
  }, children)));
}
function SortableListItem(props) {
  const {
    setNodeRef,
    transform,
    transition
  } = (0, _sortable.useSortable)({
    id: props.id
  });
  const style = {
    transform: _utilities.CSS.Transform.toString(transform),
    transition
  };
  const {
    collapsed
  } = props;
  return (0, _core.jsx)(ListItem, {
    sortable: true,
    ref: setNodeRef,
    style: style,
    css: /*#__PURE__*/(0, _core.css)([styles.listControlItem, collapsed && styles.listControlItemCollapsed], ";label:SortableListItem;" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3SE0iLCJmaWxlIjoiLi4vLi4vc3JjL0xpc3RDb250cm9sLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgSW1tdXRhYmxlUHJvcFR5cGVzIGZyb20gJ3JlYWN0LWltbXV0YWJsZS1wcm9wdHlwZXMnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xuaW1wb3J0IHsgY3NzLCBDbGFzc05hbWVzIH0gZnJvbSAnQGVtb3Rpb24vY29yZSc7XG5pbXBvcnQgeyBMaXN0LCBNYXAsIGZyb21KUyB9IGZyb20gJ2ltbXV0YWJsZSc7XG5pbXBvcnQgeyBwYXJ0aWFsLCBpc0VtcHR5LCB1bmlxdWVJZCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgdXVpZCBmcm9tICd1dWlkL3Y0JztcbmltcG9ydCBEZWNhcENtc1dpZGdldE9iamVjdCBmcm9tICdkZWNhcC1jbXMtd2lkZ2V0LW9iamVjdCc7XG5pbXBvcnQge1xuICBEbmRDb250ZXh0LFxuICBNb3VzZVNlbnNvcixcbiAgVG91Y2hTZW5zb3IsXG4gIGNsb3Nlc3RDZW50ZXIsXG4gIHVzZVNlbnNvcixcbiAgdXNlU2Vuc29ycyxcbn0gZnJvbSAnQGRuZC1raXQvY29yZSc7XG5pbXBvcnQgeyBTb3J0YWJsZUNvbnRleHQsIHVzZVNvcnRhYmxlIH0gZnJvbSAnQGRuZC1raXQvc29ydGFibGUnO1xuaW1wb3J0IHsgcmVzdHJpY3RUb1BhcmVudEVsZW1lbnQgfSBmcm9tICdAZG5kLWtpdC9tb2RpZmllcnMnO1xuaW1wb3J0IHsgQ1NTIH0gZnJvbSAnQGRuZC1raXQvdXRpbGl0aWVzJztcbmltcG9ydCB7XG4gIExpc3RJdGVtVG9wQmFyLFxuICBPYmplY3RXaWRnZXRUb3BCYXIsXG4gIGNvbG9ycyxcbiAgbGVuZ3RocyxcbiAgRmllbGRMYWJlbCxcbn0gZnJvbSAnZGVjYXAtY21zLXVpLWRlZmF1bHQnO1xuaW1wb3J0IHsgc3RyaW5nVGVtcGxhdGUsIHZhbGlkYXRpb25zIH0gZnJvbSAnZGVjYXAtY21zLWxpYi13aWRnZXRzJztcblxuaW1wb3J0IHtcbiAgVFlQRVNfS0VZLFxuICBnZXRUeXBlZEZpZWxkRm9yVmFsdWUsXG4gIHJlc29sdmVGaWVsZEtleVR5cGUsXG4gIGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZSxcbn0gZnJvbSAnLi90eXBlZExpc3RIZWxwZXJzJztcblxuY29uc3QgT2JqZWN0Q29udHJvbCA9IERlY2FwQ21zV2lkZ2V0T2JqZWN0LmNvbnRyb2xDb21wb25lbnQ7XG5cbmNvbnN0IExpc3RJdGVtID0gc3R5bGVkLmRpdigpO1xuXG5jb25zdCBTdHlsZWRMaXN0SXRlbVRvcEJhciA9IHN0eWxlZChMaXN0SXRlbVRvcEJhcilgXG4gIGJhY2tncm91bmQtY29sb3I6ICR7Y29sb3JzLnRleHRGaWVsZEJvcmRlcn07XG5gO1xuXG5jb25zdCBOZXN0ZWRPYmplY3RMYWJlbCA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6ICR7cHJvcHMgPT4gKHByb3BzLmNvbGxhcHNlZCA/ICdibG9jaycgOiAnbm9uZScpfTtcbiAgYm9yZGVyLXRvcDogMDtcbiAgY29sb3I6ICR7cHJvcHMgPT4gKHByb3BzLmVycm9yID8gY29sb3JzLmVycm9yVGV4dCA6ICdpbmhlcml0Jyl9O1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuICBwYWRkaW5nOiAxM3B4O1xuICBib3JkZXItcmFkaXVzOiAwIDAgJHtsZW5ndGhzLmJvcmRlclJhZGl1c30gJHtsZW5ndGhzLmJvcmRlclJhZGl1c307XG5gO1xuXG5jb25zdCBzdHlsZVN0cmluZ3MgPSB7XG4gIGNvbGxhcHNlZE9iamVjdENvbnRyb2w6IGBcbiAgICBkaXNwbGF5OiBub25lO1xuICBgLFxuICBvYmplY3RXaWRnZXRUb3BCYXJDb250YWluZXI6IGBcbiAgICBwYWRkaW5nOiAke2xlbmd0aHMub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyUGFkZGluZ307XG4gIGAsXG59O1xuXG5jb25zdCBzdHlsZXMgPSB7XG4gIGxpc3RDb250cm9sSXRlbTogY3NzYFxuICAgIG1hcmdpbi10b3A6IDE4cHg7XG5cbiAgICAmOmZpcnN0LW9mLXR5cGUge1xuICAgICAgbWFyZ2luLXRvcDogMjZweDtcbiAgICB9XG4gIGAsXG4gIGxpc3RDb250cm9sSXRlbUNvbGxhcHNlZDogY3NzYFxuICAgIHBhZGRpbmctYm90dG9tOiAwO1xuICBgLFxufTtcblxuZnVuY3Rpb24gU29ydGFibGVMaXN0KHsgaXRlbXMsIGNoaWxkcmVuLCBvblNvcnRFbmQsIGtleXMgfSkge1xuICBjb25zdCBhY3RpdmF0aW9uQ29uc3RyYWludCA9IHsgZGlzdGFuY2U6IDQgfTtcbiAgY29uc3Qgc2Vuc29ycyA9IHVzZVNlbnNvcnMoXG4gICAgdXNlU2Vuc29yKE1vdXNlU2Vuc29yLCB7IGFjdGl2YXRpb25Db25zdHJhaW50IH0pLFxuICAgIHVzZVNlbnNvcihUb3VjaFNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgKTtcblxuICBmdW5jdGlvbiBoYW5kbGVTb3J0RW5kKHsgYWN0aXZlLCBvdmVyIH0pIHtcbiAgICBvblNvcnRFbmQoe1xuICAgICAgb2xkSW5kZXg6IGtleXMuaW5kZXhPZihhY3RpdmUuaWQpLFxuICAgICAgbmV3SW5kZXg6IGtleXMuaW5kZXhPZihvdmVyLmlkKSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdj5cbiAgICAgIDxEbmRDb250ZXh0XG4gICAgICAgIG1vZGlmaWVycz17W3Jlc3RyaWN0VG9QYXJlbnRFbGVtZW50XX1cbiAgICAgICAgY29sbGlzaW9uRGV0ZWN0aW9uPXtjbG9zZXN0Q2VudGVyfVxuICAgICAgICBzZW5zb3JzPXtzZW5zb3JzfVxuICAgICAgICBvbkRyYWdFbmQ9e2hhbmRsZVNvcnRFbmR9XG4gICAgICA+XG4gICAgICAgIDxTb3J0YWJsZUNvbnRleHQgaXRlbXM9e2l0ZW1zfT57Y2hpbGRyZW59PC9Tb3J0YWJsZUNvbnRleHQ+XG4gICAgICA8L0RuZENvbnRleHQ+XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdEl0ZW0ocHJvcHMpIHtcbiAgY29uc3QgeyBzZXROb2RlUmVmLCB0cmFuc2Zvcm0sIHRyYW5zaXRpb24gfSA9IHVzZVNvcnRhYmxlKHtcbiAgICBpZDogcHJvcHMuaWQsXG4gIH0pO1xuXG4gIGNvbnN0IHN0eWxlID0ge1xuICAgIHRyYW5zZm9ybTogQ1NTLlRyYW5zZm9ybS50b1N0cmluZyh0cmFuc2Zvcm0pLFxuICAgIHRyYW5zaXRpb24sXG4gIH07XG5cbiAgY29uc3QgeyBjb2xsYXBzZWQgfSA9IHByb3BzO1xuXG4gIHJldHVybiAoXG4gICAgPExpc3RJdGVtXG4gICAgICBzb3J0YWJsZVxuICAgICAgcmVmPXtzZXROb2RlUmVmfVxuICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgY3NzPXtbc3R5bGVzLmxpc3RDb250cm9sSXRlbSwgY29sbGFwc2VkICYmIHN0eWxlcy5saXN0Q29udHJvbEl0ZW1Db2xsYXBzZWRdfVxuICAgID5cbiAgICAgIHtwcm9wcy5jaGlsZHJlbn1cbiAgICA8L0xpc3RJdGVtPlxuICApO1xufVxuXG5mdW5jdGlvbiBEcmFnSGFuZGxlKHsgY2hpbGRyZW4sIGlkIH0pIHtcbiAgY29uc3QgeyBhdHRyaWJ1dGVzLCBsaXN0ZW5lcnMgfSA9IHVzZVNvcnRhYmxlKHtcbiAgICBpZCxcbiAgfSk7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IHsuLi5hdHRyaWJ1dGVzfSB7Li4ubGlzdGVuZXJzfT5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L2Rpdj5cbiAgKTtcbn1cblxuY29uc3QgdmFsdWVUeXBlcyA9IHtcbiAgU0lOR0xFOiAnU0lOR0xFJyxcbiAgTVVMVElQTEU6ICdNVUxUSVBMRScsXG4gIE1JWEVEOiAnTUlYRUQnLFxufTtcblxuZnVuY3Rpb24gaGFuZGxlU3VtbWFyeShzdW1tYXJ5LCBlbnRyeSwgbGFiZWwsIGl0ZW0pIHtcbiAgY29uc3QgZGF0YSA9IHN0cmluZ1RlbXBsYXRlLmFkZEZpbGVUZW1wbGF0ZUZpZWxkcyhcbiAgICBlbnRyeS5nZXQoJ3BhdGgnKSxcbiAgICBpdGVtLnNldCgnZmllbGRzLmxhYmVsJywgbGFiZWwpLFxuICApO1xuICByZXR1cm4gc3RyaW5nVGVtcGxhdGUuY29tcGlsZVN0cmluZ1RlbXBsYXRlKHN1bW1hcnksIG51bGwsICcnLCBkYXRhKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSB7XG4gIGlmICghTWFwLmlzTWFwKGl0ZW0pKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgYCcke2ZpZWxkLmdldCgnbmFtZScpfScgZmllbGQgaXRlbSB2YWx1ZSB2YWx1ZSBzaG91bGQgYmUgYSBtYXAgYnV0IGlzIGEgJyR7dHlwZW9mIGl0ZW19J2AsXG4gICAgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIExhYmVsQ29tcG9uZW50KHsgZmllbGQsIGlzQWN0aXZlLCBoYXNFcnJvcnMsIHVuaXF1ZUZpZWxkSWQsIGlzRmllbGRPcHRpb25hbCwgdCB9KSB7XG4gIGNvbnN0IGxhYmVsID0gYCR7ZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKX1gO1xuICByZXR1cm4gKFxuICAgIDxGaWVsZExhYmVsIGlzQWN0aXZlPXtpc0FjdGl2ZX0gaGFzRXJyb3JzPXtoYXNFcnJvcnN9IGh0bWxGb3I9e3VuaXF1ZUZpZWxkSWR9PlxuICAgICAge2xhYmVsfSB7YCR7aXNGaWVsZE9wdGlvbmFsID8gYCAoJHt0KCdlZGl0b3IuZWRpdG9yQ29udHJvbC5maWVsZC5vcHRpb25hbCcpfSlgIDogJyd9YH1cbiAgICA8L0ZpZWxkTGFiZWw+XG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExpc3RDb250cm9sIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgdmFsaWRhdGlvbnMgPSBbXTtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG1ldGFkYXRhOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLFxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQ2hhbmdlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uVmFsaWRhdGVPYmplY3Q6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgdmFsaWRhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgdmFsdWU6IEltbXV0YWJsZVByb3BUeXBlcy5saXN0LFxuICAgIGZpZWxkOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGZvcklEOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNvbnRyb2xSZWY6IFByb3BUeXBlcy5mdW5jLFxuICAgIG1lZGlhUGF0aHM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBnZXRBc3NldDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbk9wZW5NZWRpYUxpYnJhcnk6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25BZGRBc3NldDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblJlbW92ZUluc2VydGVkTWVkaWE6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xhc3NOYW1lV3JhcHBlcjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHNldEFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHNldEluYWN0aXZlU3R5bGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgZWRpdG9yQ29udHJvbDogUHJvcFR5cGVzLmVsZW1lbnRUeXBlLmlzUmVxdWlyZWQsXG4gICAgcmVzb2x2ZVdpZGdldDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBjbGVhckZpZWxkRXJyb3JzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGZpZWxkc0Vycm9yczogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIGVudHJ5OiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgdDogUHJvcFR5cGVzLmZ1bmMsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICB2YWx1ZTogTGlzdCgpLFxuICAgIHBhcmVudElkczogW10sXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUgfSA9IHByb3BzO1xuICAgIGNvbnN0IGxpc3RDb2xsYXBzZWQgPSBmaWVsZC5nZXQoJ2NvbGxhcHNlZCcsIHRydWUpO1xuICAgIGNvbnN0IGl0ZW1zQ29sbGFwc2VkID0gKHZhbHVlICYmIEFycmF5KHZhbHVlLnNpemUpLmZpbGwobGlzdENvbGxhcHNlZCkpIHx8IFtdO1xuICAgIGNvbnN0IGtleXMgPSAodmFsdWUgJiYgQXJyYXkuZnJvbSh7IGxlbmd0aDogdmFsdWUuc2l6ZSB9LCAoKSA9PiB1dWlkKCkpKSB8fCBbXTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBsaXN0Q29sbGFwc2VkLFxuICAgICAgaXRlbXNDb2xsYXBzZWQsXG4gICAgICB2YWx1ZTogdGhpcy52YWx1ZVRvU3RyaW5nKHZhbHVlKSxcbiAgICAgIGtleXMsXG4gICAgfTtcbiAgfVxuXG4gIHZhbHVlVG9TdHJpbmcgPSB2YWx1ZSA9PiB7XG4gICAgbGV0IHN0cmluZ1ZhbHVlO1xuICAgIGlmIChMaXN0LmlzTGlzdCh2YWx1ZSkgfHwgQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIHN0cmluZ1ZhbHVlID0gdmFsdWUuam9pbignLCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBFeHBlY3RlZCBMaXN0IHZhbHVlIHRvIGJlIGFuIGFycmF5IGJ1dCByZWNlaXZlZCAnJHt2YWx1ZX0nIHdpdGggdHlwZSBvZiAnJHt0eXBlb2YgdmFsdWV9Jy4gUGxlYXNlIGNoZWNrIHRoZSB2YWx1ZSBwcm92aWRlZCB0byB0aGUgJyR7dGhpcy5wcm9wcy5maWVsZC5nZXQoXG4gICAgICAgICAgJ25hbWUnLFxuICAgICAgICApfScgZmllbGRgLFxuICAgICAgKTtcbiAgICAgIHN0cmluZ1ZhbHVlID0gU3RyaW5nKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ1ZhbHVlLnJlcGxhY2UoLywoW15cXHNdfCQpL2csICcsICQxJyk7XG4gIH07XG5cbiAgZ2V0VmFsdWVUeXBlID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkLmdldCgnZmllbGRzJykpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1VTFRJUExFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KCdmaWVsZCcpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5TSU5HTEU7XG4gICAgfSBlbHNlIGlmIChmaWVsZC5nZXQoVFlQRVNfS0VZKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfTtcblxuICB1bmlxdWVGaWVsZElkID0gdW5pcXVlSWQoYCR7dGhpcy5wcm9wcy5maWVsZC5nZXQoJ25hbWUnKX0tZmllbGQtYCk7XG4gIC8qKlxuICAgKiBBbHdheXMgdXBkYXRlIHNvIHRoYXQgZWFjaCBuZXN0ZWQgd2lkZ2V0IGhhcyB0aGUgb3B0aW9uIHRvIHVwZGF0ZS4gVGhpcyBpc1xuICAgKiByZXF1aXJlZCBiZWNhdXNlIENvbnRyb2xIT0MgcHJvdmlkZXMgYSBkZWZhdWx0IGBzaG91bGRDb21wb25lbnRVcGRhdGVgXG4gICAqIHdoaWNoIG9ubHkgdXBkYXRlcyBpZiB0aGUgdmFsdWUgY2hhbmdlcywgYnV0IGV2ZXJ5IHdpZGdldCBtdXN0IGJlIGFsbG93ZWRcbiAgICogdG8gb3ZlcnJpZGUgdGhpcy5cbiAgICovXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZSgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGhhbmRsZUNoYW5nZSA9IGUgPT4ge1xuICAgIGNvbnN0IHsgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgIGNvbnN0IG5ld1ZhbHVlID0gZS50YXJnZXQudmFsdWUudHJpbSgpO1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IG5ld1ZhbHVlID8gbmV3VmFsdWUuc3BsaXQoJywnKSA6IFtdO1xuICAgIGlmIChuZXdWYWx1ZS5tYXRjaCgvLCQvKSAmJiBvbGRWYWx1ZS5tYXRjaCgvLCAkLykpIHtcbiAgICAgIGxpc3RWYWx1ZS5wb3AoKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogcGFyc2VkVmFsdWUgfSk7XG4gICAgb25DaGFuZ2UoTGlzdChsaXN0VmFsdWUubWFwKHZhbCA9PiB2YWwudHJpbSgpKSkpO1xuICB9O1xuXG4gIGhhbmRsZUZvY3VzID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMuc2V0QWN0aXZlU3R5bGUoKTtcbiAgfTtcblxuICBoYW5kbGVCbHVyID0gZSA9PiB7XG4gICAgY29uc3QgbGlzdFZhbHVlID0gZS50YXJnZXQudmFsdWVcbiAgICAgIC5zcGxpdCgnLCcpXG4gICAgICAubWFwKGVsID0+IGVsLnRyaW0oKSlcbiAgICAgIC5maWx0ZXIoZWwgPT4gZWwpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogdGhpcy52YWx1ZVRvU3RyaW5nKGxpc3RWYWx1ZSkgfSk7XG4gICAgdGhpcy5wcm9wcy5zZXRJbmFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQWRkID0gZSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPVxuICAgICAgdGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEVcbiAgICAgICAgPyB0aGlzLnNpbmdsZURlZmF1bHQoKVxuICAgICAgICA6IGZyb21KUyh0aGlzLm11bHRpcGxlRGVmYXVsdChmaWVsZC5nZXQoJ2ZpZWxkcycpKSk7XG4gICAgdGhpcy5hZGRJdGVtKHBhcnNlZFZhbHVlKTtcbiAgfTtcblxuICBzaW5nbGVEZWZhdWx0ID0gKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmZpZWxkLmdldEluKFsnZmllbGQnLCAnZGVmYXVsdCddLCBudWxsKTtcbiAgfTtcblxuICBtdWx0aXBsZURlZmF1bHQgPSBmaWVsZHMgPT4ge1xuICAgIHJldHVybiB0aGlzLmdldEZpZWxkc0RlZmF1bHQoZmllbGRzKTtcbiAgfTtcblxuICBoYW5kbGVBZGRUeXBlID0gKHR5cGUsIHR5cGVLZXkpID0+IHtcbiAgICBjb25zdCBwYXJzZWRWYWx1ZSA9IGZyb21KUyh0aGlzLm1peGVkRGVmYXVsdCh0eXBlS2V5LCB0eXBlKSk7XG4gICAgdGhpcy5hZGRJdGVtKHBhcnNlZFZhbHVlKTtcbiAgfTtcblxuICBtaXhlZERlZmF1bHQgPSAodHlwZUtleSwgdHlwZSkgPT4ge1xuICAgIGNvbnN0IHNlbGVjdGVkVHlwZSA9IHRoaXMucHJvcHMuZmllbGQuZ2V0KFRZUEVTX0tFWSkuZmluZChmID0+IGYuZ2V0KCduYW1lJykgPT09IHR5cGUpO1xuICAgIGNvbnN0IGZpZWxkcyA9IHNlbGVjdGVkVHlwZS5nZXQoJ2ZpZWxkcycpIHx8IFtzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZCcpXTtcblxuICAgIHJldHVybiB0aGlzLmdldEZpZWxkc0RlZmF1bHQoZmllbGRzLCB7IFt0eXBlS2V5XTogdHlwZSB9KTtcbiAgfTtcblxuICBnZXRGaWVsZHNEZWZhdWx0ID0gKGZpZWxkcywgaW5pdGlhbFZhbHVlID0ge30pID0+IHtcbiAgICByZXR1cm4gZmllbGRzLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgICBjb25zdCBzdWJmaWVsZHMgPSBpdGVtLmdldCgnZmllbGQnKSB8fCBpdGVtLmdldCgnZmllbGRzJyk7XG4gICAgICBjb25zdCBvYmplY3QgPSBpdGVtLmdldCgnd2lkZ2V0JykgPT0gJ29iamVjdCc7XG4gICAgICBjb25zdCBuYW1lID0gaXRlbS5nZXQoJ25hbWUnKTtcbiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IGl0ZW0uZ2V0KCdkZWZhdWx0JywgbnVsbCk7XG5cbiAgICAgIGlmIChMaXN0LmlzTGlzdChzdWJmaWVsZHMpICYmIG9iamVjdCkge1xuICAgICAgICBjb25zdCBzdWJEZWZhdWx0VmFsdWUgPSB0aGlzLmdldEZpZWxkc0RlZmF1bHQoc3ViZmllbGRzKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKE1hcC5pc01hcChzdWJmaWVsZHMpICYmIG9iamVjdCkge1xuICAgICAgICBjb25zdCBzdWJEZWZhdWx0VmFsdWUgPSB0aGlzLmdldEZpZWxkc0RlZmF1bHQoW3N1YmZpZWxkc10pO1xuICAgICAgICAhaXNFbXB0eShzdWJEZWZhdWx0VmFsdWUpICYmIChhY2NbbmFtZV0gPSBzdWJEZWZhdWx0VmFsdWUpO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGVmYXVsdFZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgIGFjY1tuYW1lXSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCBpbml0aWFsVmFsdWUpO1xuICB9O1xuXG4gIGFkZEl0ZW0gPSBwYXJzZWRWYWx1ZSA9PiB7XG4gICAgY29uc3QgeyB2YWx1ZSwgb25DaGFuZ2UsIGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGFkZFRvVG9wID0gZmllbGQuZ2V0KCdhZGRfdG9fdG9wJywgZmFsc2UpO1xuXG4gICAgY29uc3QgaXRlbUtleSA9IHV1aWQoKTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGl0ZW1zQ29sbGFwc2VkOiBhZGRUb1RvcFxuICAgICAgICA/IFtmYWxzZSwgLi4udGhpcy5zdGF0ZS5pdGVtc0NvbGxhcHNlZF1cbiAgICAgICAgOiBbLi4udGhpcy5zdGF0ZS5pdGVtc0NvbGxhcHNlZCwgZmFsc2VdLFxuICAgICAga2V5czogYWRkVG9Ub3AgPyBbaXRlbUtleSwgLi4udGhpcy5zdGF0ZS5rZXlzXSA6IFsuLi50aGlzLnN0YXRlLmtleXMsIGl0ZW1LZXldLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbGlzdFZhbHVlID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGlmIChhZGRUb1RvcCkge1xuICAgICAgb25DaGFuZ2UobGlzdFZhbHVlLnVuc2hpZnQocGFyc2VkVmFsdWUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25DaGFuZ2UobGlzdFZhbHVlLnB1c2gocGFyc2VkVmFsdWUpKTtcbiAgICB9XG4gIH07XG5cbiAgcHJvY2Vzc0NvbnRyb2xSZWYgPSByZWYgPT4ge1xuICAgIGlmICghcmVmKSByZXR1cm47XG4gICAgY29uc3Qge1xuICAgICAgdmFsaWRhdGUsXG4gICAgICBwcm9wczogeyB2YWxpZGF0aW9uS2V5OiBrZXkgfSxcbiAgICB9ID0gcmVmO1xuICAgIHRoaXMudmFsaWRhdGlvbnMucHVzaCh7IGtleSwgdmFsaWRhdGUgfSk7XG4gIH07XG5cbiAgdmFsaWRhdGUgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMuZ2V0VmFsdWVUeXBlKCkpIHtcbiAgICAgIHRoaXMudmFsaWRhdGlvbnMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS52YWxpZGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvcHMudmFsaWRhdGUoKTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vblZhbGlkYXRlT2JqZWN0KHRoaXMucHJvcHMuZm9ySUQsIHRoaXMudmFsaWRhdGVTaXplKCkpO1xuICB9O1xuXG4gIHZhbGlkYXRlU2l6ZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkLCB2YWx1ZSwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBtaW4gPSBmaWVsZC5nZXQoJ21pbicpO1xuICAgIGNvbnN0IG1heCA9IGZpZWxkLmdldCgnbWF4Jyk7XG4gICAgY29uc3QgcmVxdWlyZWQgPSBmaWVsZC5nZXQoJ3JlcXVpcmVkJywgdHJ1ZSk7XG5cbiAgICBpZiAoIXJlcXVpcmVkICYmICF2YWx1ZT8uc2l6ZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IGVycm9yID0gdmFsaWRhdGlvbnMudmFsaWRhdGVNaW5NYXgoXG4gICAgICB0LFxuICAgICAgZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKSxcbiAgICAgIHZhbHVlLFxuICAgICAgbWluLFxuICAgICAgbWF4LFxuICAgICk7XG5cbiAgICByZXR1cm4gZXJyb3IgPyBbZXJyb3JdIDogW107XG4gIH07XG5cbiAgLyoqXG4gICAqIEluIGNhc2UgdGhlIGBvbkNoYW5nZU9iamVjdGAgZnVuY3Rpb24gaXMgZnJvemVuIGJ5IGEgY2hpbGQgd2lkZ2V0IGltcGxlbWVudGF0aW9uLFxuICAgKiBlLmcuIHdoZW4gZGVib3VuY2VkLCBhbHdheXMgZ2V0IHRoZSBsYXRlc3Qgb2JqZWN0IHZhbHVlIGluc3RlYWQgb2YgdXNpbmdcbiAgICogYHRoaXMucHJvcHMudmFsdWVgIGRpcmVjdGx5LlxuICAgKi9cbiAgZ2V0T2JqZWN0VmFsdWUgPSBpZHggPT4gdGhpcy5wcm9wcy52YWx1ZS5nZXQoaWR4KSB8fCBNYXAoKTtcblxuICBoYW5kbGVDaGFuZ2VGb3IoaW5kZXgpIHtcbiAgICByZXR1cm4gKGYsIG5ld1ZhbHVlLCBuZXdNZXRhZGF0YSkgPT4ge1xuICAgICAgY29uc3QgeyB2YWx1ZSwgbWV0YWRhdGEsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBsaXN0RmllbGRPYmplY3RXaWRnZXQgPSBmaWVsZC5nZXRJbihbJ2ZpZWxkJywgJ3dpZGdldCddKSA9PT0gJ29iamVjdCc7XG4gICAgICBjb25zdCB3aXRoTmFtZUtleSA9XG4gICAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgIT09IHZhbHVlVHlwZXMuU0lOR0xFIHx8XG4gICAgICAgICh0aGlzLmdldFZhbHVlVHlwZSgpID09PSB2YWx1ZVR5cGVzLlNJTkdMRSAmJiBsaXN0RmllbGRPYmplY3RXaWRnZXQpO1xuICAgICAgY29uc3QgbmV3T2JqZWN0VmFsdWUgPSB3aXRoTmFtZUtleVxuICAgICAgICA/IHRoaXMuZ2V0T2JqZWN0VmFsdWUoaW5kZXgpLnNldChmLmdldCgnbmFtZScpLCBuZXdWYWx1ZSlcbiAgICAgICAgOiBuZXdWYWx1ZTtcbiAgICAgIGNvbnN0IHBhcnNlZE1ldGFkYXRhID0ge1xuICAgICAgICBbY29sbGVjdGlvbk5hbWVdOiBPYmplY3QuYXNzaWduKG1ldGFkYXRhID8gbWV0YWRhdGEudG9KUygpIDoge30sIG5ld01ldGFkYXRhIHx8IHt9KSxcbiAgICAgIH07XG4gICAgICBvbkNoYW5nZSh2YWx1ZS5zZXQoaW5kZXgsIG5ld09iamVjdFZhbHVlKSwgcGFyc2VkTWV0YWRhdGEpO1xuICAgIH07XG4gIH1cblxuICBoYW5kbGVSZW1vdmUgPSAoaW5kZXgsIGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQsIGNsZWFyRmllbGRFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY29sbGVjdGlvbk5hbWUgPSBmaWVsZC5nZXQoJ25hbWUnKTtcbiAgICBjb25zdCBpc1NpbmdsZUZpZWxkID0gdGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEU7XG5cbiAgICBjb25zdCBtZXRhZGF0YVJlbW92ZVBhdGggPSBpc1NpbmdsZUZpZWxkID8gdmFsdWUuZ2V0KGluZGV4KSA6IHZhbHVlLmdldChpbmRleCkudmFsdWVTZXEoKTtcbiAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9XG4gICAgICBtZXRhZGF0YSAmJiAhbWV0YWRhdGEuaXNFbXB0eSgpXG4gICAgICAgID8geyBbY29sbGVjdGlvbk5hbWVdOiBtZXRhZGF0YS5yZW1vdmVJbihtZXRhZGF0YVJlbW92ZVBhdGgpIH1cbiAgICAgICAgOiBtZXRhZGF0YTtcblxuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShpbmRleCwgMSk7XG4gICAgLy8gY2xlYXIgdmFsaWRhdGlvbnNcbiAgICB0aGlzLnZhbGlkYXRpb25zID0gW107XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGl0ZW1zQ29sbGFwc2VkOiBbLi4uaXRlbXNDb2xsYXBzZWRdLFxuICAgICAga2V5czogQXJyYXkuZnJvbSh7IGxlbmd0aDogdmFsdWUuc2l6ZSAtIDEgfSwgKCkgPT4gdXVpZCgpKSxcbiAgICB9KTtcblxuICAgIG9uQ2hhbmdlKHZhbHVlLnJlbW92ZShpbmRleCksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICBjbGVhckZpZWxkRXJyb3JzKCk7XG4gIH07XG5cbiAgaGFuZGxlSXRlbUNvbGxhcHNlVG9nZ2xlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBuZXdJdGVtc0NvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkLm1hcCgoY29sbGFwc2VkLCBpdGVtSW5kZXgpID0+IHtcbiAgICAgIGlmIChpbmRleCA9PT0gaXRlbUluZGV4KSB7XG4gICAgICAgIHJldHVybiAhY29sbGFwc2VkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbGxhcHNlZDtcbiAgICB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGl0ZW1zQ29sbGFwc2VkOiBuZXdJdGVtc0NvbGxhcHNlZCxcbiAgICB9KTtcbiAgfTtcblxuICBoYW5kbGVDb2xsYXBzZUFsbFRvZ2dsZSA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IHZhbHVlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IG1pbmltaXplQ29sbGFwc2VkSXRlbXMgPSBmaWVsZC5nZXQoJ21pbmltaXplX2NvbGxhcHNlZCcsIGZhbHNlKTtcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkQnlEZWZhdWx0ID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBhbGxJdGVtc0NvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkLmV2ZXJ5KHZhbCA9PiB2YWwgPT09IHRydWUpO1xuXG4gICAgaWYgKG1pbmltaXplQ29sbGFwc2VkSXRlbXMpIHtcbiAgICAgIGxldCB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZDtcbiAgICAgIC8vIE9ubHkgYWxsb3cgY29sbGFwc2luZyBhbGwgaXRlbXMgaW4gdGhpcyBtb2RlIGJ1dCBub3Qgb3BlbmluZyBhbGwgYXQgb25jZVxuICAgICAgaWYgKCFsaXN0Q29sbGFwc2VkIHx8ICFsaXN0Q29sbGFwc2VkQnlEZWZhdWx0KSB7XG4gICAgICAgIHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCA9IEFycmF5KHZhbHVlLnNpemUpLmZpbGwoIWxpc3RDb2xsYXBzZWQpO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxpc3RDb2xsYXBzZWQ6ICFsaXN0Q29sbGFwc2VkLCBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgaXRlbXNDb2xsYXBzZWQ6IEFycmF5KHZhbHVlLnNpemUpLmZpbGwoIWFsbEl0ZW1zQ29sbGFwc2VkKSB9KTtcbiAgICB9XG4gIH07XG5cbiAgb2JqZWN0TGFiZWwoaXRlbSkge1xuICAgIGNvbnN0IHsgZmllbGQsIGVudHJ5IH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHZhbHVlVHlwZSA9IHRoaXMuZ2V0VmFsdWVUeXBlKCk7XG4gICAgc3dpdGNoICh2YWx1ZVR5cGUpIHtcbiAgICAgIGNhc2UgdmFsdWVUeXBlcy5NSVhFRDoge1xuICAgICAgICBpZiAoIXZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbVR5cGUgPSBnZXRUeXBlZEZpZWxkRm9yVmFsdWUoZmllbGQsIGl0ZW0pO1xuICAgICAgICBjb25zdCBsYWJlbCA9IGl0ZW1UeXBlLmdldCgnbGFiZWwnLCBpdGVtVHlwZS5nZXQoJ25hbWUnKSk7XG4gICAgICAgIC8vIGVhY2ggdHlwZSBjYW4gaGF2ZSBpdHMgb3duIHN1bW1hcnksIGJ1dCBkZWZhdWx0IHRvIHRoZSBsaXN0IHN1bW1hcnkgaWYgZXhpc3RzXG4gICAgICAgIGNvbnN0IHN1bW1hcnkgPSBpdGVtVHlwZS5nZXQoJ3N1bW1hcnknLCBmaWVsZC5nZXQoJ3N1bW1hcnknKSk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSA6IGxhYmVsO1xuICAgICAgICByZXR1cm4gbGFiZWxSZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuU0lOR0xFOiB7XG4gICAgICAgIGNvbnN0IHNpbmdsZUZpZWxkID0gZmllbGQuZ2V0KCdmaWVsZCcpO1xuICAgICAgICBjb25zdCBsYWJlbCA9IHNpbmdsZUZpZWxkLmdldCgnbGFiZWwnLCBzaW5nbGVGaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgICAgIGNvbnN0IHN1bW1hcnkgPSBmaWVsZC5nZXQoJ3N1bW1hcnknKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IGZyb21KUyh7IFtzaW5nbGVGaWVsZC5nZXQoJ25hbWUnKV06IGl0ZW0gfSk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBkYXRhKSA6IGxhYmVsO1xuICAgICAgICByZXR1cm4gbGFiZWxSZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTVVMVElQTEU6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG11bHRpRmllbGRzID0gZmllbGQuZ2V0KCdmaWVsZHMnKTtcbiAgICAgICAgY29uc3QgbGFiZWxGaWVsZCA9IG11bHRpRmllbGRzICYmIG11bHRpRmllbGRzLmZpcnN0KCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gaXRlbS5nZXQobGFiZWxGaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgICAgIGNvbnN0IHN1bW1hcnkgPSBmaWVsZC5nZXQoJ3N1bW1hcnknKTtcbiAgICAgICAgY29uc3QgbGFiZWxSZXR1cm4gPSBzdW1tYXJ5ID8gaGFuZGxlU3VtbWFyeShzdW1tYXJ5LCBlbnRyeSwgdmFsdWUsIGl0ZW0pIDogdmFsdWU7XG4gICAgICAgIHJldHVybiAobGFiZWxSZXR1cm4gfHwgYE5vICR7bGFiZWxGaWVsZC5nZXQoJ25hbWUnKX1gKS50b1N0cmluZygpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBvblNvcnRFbmQgPSAoeyBvbGRJbmRleCwgbmV3SW5kZXggfSkgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIGNsZWFyRmllbGRFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwga2V5cyB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIC8vIFVwZGF0ZSB2YWx1ZVxuICAgIGNvbnN0IGl0ZW0gPSB2YWx1ZS5nZXQob2xkSW5kZXgpO1xuICAgIGNvbnN0IG5ld1ZhbHVlID0gdmFsdWUuZGVsZXRlKG9sZEluZGV4KS5pbnNlcnQobmV3SW5kZXgsIGl0ZW0pO1xuICAgIHRoaXMucHJvcHMub25DaGFuZ2UobmV3VmFsdWUpO1xuXG4gICAgLy8gVXBkYXRlIGNvbGxhcHNpbmdcbiAgICBjb25zdCBjb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZFtvbGRJbmRleF07XG4gICAgaXRlbXNDb2xsYXBzZWQuc3BsaWNlKG9sZEluZGV4LCAxKTtcbiAgICBjb25zdCB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBbLi4uaXRlbXNDb2xsYXBzZWRdO1xuICAgIHVwZGF0ZWRJdGVtc0NvbGxhcHNlZC5zcGxpY2UobmV3SW5kZXgsIDAsIGNvbGxhcHNlZCk7XG5cbiAgICAvLyBSZXNldCBpdGVtIHRvIGVuc3VyZSB1cGRhdGVkIHN0YXRlXG4gICAgY29uc3QgdXBkYXRlZEtleXMgPSBrZXlzLm1hcCgoa2V5LCBrZXlJbmRleCkgPT4ge1xuICAgICAgaWYgKGtleUluZGV4ID09PSBvbGRJbmRleCB8fCBrZXlJbmRleCA9PT0gbmV3SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHV1aWQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBrZXk7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiB1cGRhdGVkSXRlbXNDb2xsYXBzZWQsIGtleXM6IHVwZGF0ZWRLZXlzIH0pO1xuXG4gICAgLy9jbGVhciBlcnJvciBmaWVsZHMgYW5kIHJlbW92ZSBvbGQgdmFsaWRhdGlvbnNcbiAgICBjbGVhckZpZWxkRXJyb3JzKCk7XG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IHRoaXMudmFsaWRhdGlvbnMuZmlsdGVyKGl0ZW0gPT4gdXBkYXRlZEtleXMuaW5jbHVkZXMoaXRlbS5rZXkpKTtcbiAgfTtcblxuICBoYXNFcnJvciA9IGluZGV4ID0+IHtcbiAgICBjb25zdCB7IGZpZWxkc0Vycm9ycyB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoZmllbGRzRXJyb3JzICYmIGZpZWxkc0Vycm9ycy5zaXplID4gMCkge1xuICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZmllbGRzRXJyb3JzLnRvSlMoKSkuc29tZShhcnIgPT5cbiAgICAgICAgYXJyLnNvbWUoZXJyID0+IGVyci5wYXJlbnRJZHMgJiYgZXJyLnBhcmVudElkcy5pbmNsdWRlcyh0aGlzLnN0YXRlLmtleXNbaW5kZXhdKSksXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvZGlzcGxheS1uYW1lXG4gIHJlbmRlckl0ZW0gPSAoaXRlbSwgaW5kZXgpID0+IHtcbiAgICBjb25zdCB7XG4gICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgZWRpdG9yQ29udHJvbCxcbiAgICAgIG9uVmFsaWRhdGVPYmplY3QsXG4gICAgICBtZXRhZGF0YSxcbiAgICAgIGNsZWFyRmllbGRFcnJvcnMsXG4gICAgICBmaWVsZHNFcnJvcnMsXG4gICAgICBjb250cm9sUmVmLFxuICAgICAgcmVzb2x2ZVdpZGdldCxcbiAgICAgIHBhcmVudElkcyxcbiAgICAgIGZvcklELFxuICAgICAgdCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbaW5kZXhdO1xuICAgIGNvbnN0IGtleSA9IGtleXNbaW5kZXhdO1xuICAgIGxldCBmaWVsZCA9IHRoaXMucHJvcHMuZmllbGQ7XG4gICAgY29uc3QgaGFzRXJyb3IgPSB0aGlzLmhhc0Vycm9yKGluZGV4KTtcbiAgICBjb25zdCBpc1ZhcmlhYmxlVHlwZXNMaXN0ID0gdGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5NSVhFRDtcbiAgICBpZiAoaXNWYXJpYWJsZVR5cGVzTGlzdCkge1xuICAgICAgZmllbGQgPSBnZXRUeXBlZEZpZWxkRm9yVmFsdWUoZmllbGQsIGl0ZW0pO1xuICAgICAgaWYgKCFmaWVsZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJFcnJvbmVvdXNUeXBlZEl0ZW0oaW5kZXgsIGl0ZW0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdrdXJ3YScsIGNsYXNzTmFtZVdyYXBwZXIpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxTb3J0YWJsZUxpc3RJdGVtXG4gICAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgICAgaWQ9e2tleX1cbiAgICAgICAga2V5cz17a2V5c31cbiAgICAgID5cbiAgICAgICAge2lzVmFyaWFibGVUeXBlc0xpc3QgJiYgKFxuICAgICAgICAgIDxMYWJlbENvbXBvbmVudFxuICAgICAgICAgICAgZmllbGQ9e2ZpZWxkfVxuICAgICAgICAgICAgaXNBY3RpdmU9e2ZhbHNlfVxuICAgICAgICAgICAgaGFzRXJyb3JzPXtoYXNFcnJvcn1cbiAgICAgICAgICAgIHVuaXF1ZUZpZWxkSWQ9e3RoaXMudW5pcXVlRmllbGRJZH1cbiAgICAgICAgICAgIGlzRmllbGRPcHRpb25hbD17ZmllbGQuZ2V0KCdyZXF1aXJlZCcpID09PSBmYWxzZX1cbiAgICAgICAgICAgIHQ9e3R9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgY29sbGFwc2VkPXtjb2xsYXBzZWR9XG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17cGFydGlhbCh0aGlzLmhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSwgaW5kZXgpfVxuICAgICAgICAgIGRyYWdIYW5kbGU9e0RyYWdIYW5kbGV9XG4gICAgICAgICAgaWQ9e2tleX1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgpfVxuICAgICAgICAgIGRhdGEtdGVzdGlkPXtgc3R5bGVkLWxpc3QtaXRlbS10b3AtYmFyLSR7a2V5fWB9XG4gICAgICAgIC8+XG4gICAgICAgIDxOZXN0ZWRPYmplY3RMYWJlbCBjb2xsYXBzZWQ9e2NvbGxhcHNlZH0gZXJyb3I9e2hhc0Vycm9yfT5cbiAgICAgICAgICB7dGhpcy5vYmplY3RMYWJlbChpdGVtKX1cbiAgICAgICAgPC9OZXN0ZWRPYmplY3RMYWJlbD5cbiAgICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgICAgeyh7IGNzcywgY3ggfSkgPT4gKFxuICAgICAgICAgICAgPE9iamVjdENvbnRyb2xcbiAgICAgICAgICAgICAgY2xhc3NOYW1lV3JhcHBlcj17Y3goY2xhc3NOYW1lV3JhcHBlciwge1xuICAgICAgICAgICAgICAgIFtjc3NgXG4gICAgICAgICAgICAgICAgICAke3N0eWxlU3RyaW5ncy5jb2xsYXBzZWRPYmplY3RDb250cm9sfTtcbiAgICAgICAgICAgICAgICBgXTogY29sbGFwc2VkLFxuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgdmFsdWU9e2l0ZW19XG4gICAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgICAgb25DaGFuZ2VPYmplY3Q9e3RoaXMuaGFuZGxlQ2hhbmdlRm9yKGluZGV4KX1cbiAgICAgICAgICAgICAgZWRpdG9yQ29udHJvbD17ZWRpdG9yQ29udHJvbH1cbiAgICAgICAgICAgICAgcmVzb2x2ZVdpZGdldD17cmVzb2x2ZVdpZGdldH1cbiAgICAgICAgICAgICAgbWV0YWRhdGE9e21ldGFkYXRhfVxuICAgICAgICAgICAgICBmb3JMaXN0XG4gICAgICAgICAgICAgIG9uVmFsaWRhdGVPYmplY3Q9e29uVmFsaWRhdGVPYmplY3R9XG4gICAgICAgICAgICAgIGNsZWFyRmllbGRFcnJvcnM9e2NsZWFyRmllbGRFcnJvcnN9XG4gICAgICAgICAgICAgIGZpZWxkc0Vycm9ycz17ZmllbGRzRXJyb3JzfVxuICAgICAgICAgICAgICByZWY9e3RoaXMucHJvY2Vzc0NvbnRyb2xSZWZ9XG4gICAgICAgICAgICAgIGNvbnRyb2xSZWY9e2NvbnRyb2xSZWZ9XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25LZXk9e2tleX1cbiAgICAgICAgICAgICAgY29sbGFwc2VkPXtjb2xsYXBzZWR9XG4gICAgICAgICAgICAgIGRhdGEtdGVzdGlkPXtgb2JqZWN0LWNvbnRyb2wtJHtrZXl9YH1cbiAgICAgICAgICAgICAgaGFzRXJyb3I9e2hhc0Vycm9yfVxuICAgICAgICAgICAgICBwYXJlbnRJZHM9e1suLi5wYXJlbnRJZHMsIGZvcklELCBrZXldfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApfVxuICAgICAgICA8L0NsYXNzTmFtZXM+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfTtcblxuICByZW5kZXJFcnJvbmVvdXNUeXBlZEl0ZW0oaW5kZXgsIGl0ZW0pIHtcbiAgICBjb25zdCBmaWVsZCA9IHRoaXMucHJvcHMuZmllbGQ7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2V0RXJyb3JNZXNzYWdlRm9yVHlwZWRGaWVsZEFuZFZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICBjb25zdCBrZXkgPSBgaXRlbS0ke2luZGV4fWA7XG4gICAgcmV0dXJuIChcbiAgICAgIDxTb3J0YWJsZUxpc3RJdGVtXG4gICAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIHN0eWxlcy5saXN0Q29udHJvbEl0ZW1Db2xsYXBzZWRdfVxuICAgICAgICBpbmRleD17aW5kZXh9XG4gICAgICAgIGtleT17a2V5fVxuICAgICAgPlxuICAgICAgICA8U3R5bGVkTGlzdEl0ZW1Ub3BCYXJcbiAgICAgICAgICBvbkNvbGxhcHNlVG9nZ2xlPXtudWxsfVxuICAgICAgICAgIG9uUmVtb3ZlPXtwYXJ0aWFsKHRoaXMuaGFuZGxlUmVtb3ZlLCBpbmRleCwga2V5KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgIC8+XG4gICAgICAgIDxOZXN0ZWRPYmplY3RMYWJlbCBjb2xsYXBzZWQ9e3RydWV9IGVycm9yPXt0cnVlfT5cbiAgICAgICAgICB7ZXJyb3JNZXNzYWdlfWFhYWFzZGRcbiAgICAgICAgPC9OZXN0ZWRPYmplY3RMYWJlbD5cbiAgICAgIDwvU29ydGFibGVMaXN0SXRlbT5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyTGlzdENvbnRyb2woKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgZm9ySUQsIGZpZWxkLCBjbGFzc05hbWVXcmFwcGVyLCB0IH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGxpc3RDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgaXRlbXMgPSB2YWx1ZSB8fCBMaXN0KCk7XG4gICAgY29uc3QgbGFiZWwgPSBmaWVsZC5nZXQoJ2xhYmVsJywgZmllbGQuZ2V0KCduYW1lJykpO1xuICAgIGNvbnN0IGxhYmVsU2luZ3VsYXIgPSBmaWVsZC5nZXQoJ2xhYmVsX3Npbmd1bGFyJykgfHwgZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsaXN0TGFiZWwgPSBpdGVtcy5zaXplID09PSAxID8gbGFiZWxTaW5ndWxhci50b0xvd2VyQ2FzZSgpIDogbGFiZWwudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcbiAgICBjb25zdCBzZWxmQ29sbGFwc2VkID0gYWxsSXRlbXNDb2xsYXBzZWQgJiYgKGxpc3RDb2xsYXBzZWQgfHwgIW1pbmltaXplQ29sbGFwc2VkSXRlbXMpO1xuXG4gICAgY29uc3QgaXRlbXNBcnJheSA9IGtleXMubWFwKGtleSA9PiAoeyBpZDoga2V5IH0pKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Q2xhc3NOYW1lcz5cbiAgICAgICAgeyh7IGN4LCBjc3MgfSkgPT4gKFxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGlkPXtmb3JJRH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y3goXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXIsXG4gICAgICAgICAgICAgIGNzc2BcbiAgICAgICAgICAgICAgICAke3N0eWxlU3RyaW5ncy5vYmplY3RXaWRnZXRUb3BCYXJDb250YWluZXJ9XG4gICAgICAgICAgICAgIGAsXG4gICAgICAgICAgICApfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxPYmplY3RXaWRnZXRUb3BCYXJcbiAgICAgICAgICAgICAgYWxsb3dBZGQ9e2ZpZWxkLmdldCgnYWxsb3dfYWRkJywgdHJ1ZSl9XG4gICAgICAgICAgICAgIG9uQWRkPXt0aGlzLmhhbmRsZUFkZH1cbiAgICAgICAgICAgICAgdHlwZXM9e2ZpZWxkLmdldChUWVBFU19LRVksIG51bGwpfVxuICAgICAgICAgICAgICBvbkFkZFR5cGU9e3R5cGUgPT4gdGhpcy5oYW5kbGVBZGRUeXBlKHR5cGUsIHJlc29sdmVGaWVsZEtleVR5cGUoZmllbGQpKX1cbiAgICAgICAgICAgICAgaGVhZGluZz17YCR7aXRlbXMuc2l6ZX0gJHtsaXN0TGFiZWx9YH1cbiAgICAgICAgICAgICAgbGFiZWw9e2xhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKX1cbiAgICAgICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17dGhpcy5oYW5kbGVDb2xsYXBzZUFsbFRvZ2dsZX1cbiAgICAgICAgICAgICAgY29sbGFwc2VkPXtzZWxmQ29sbGFwc2VkfVxuICAgICAgICAgICAgICB0PXt0fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIHsoIXNlbGZDb2xsYXBzZWQgfHwgIW1pbmltaXplQ29sbGFwc2VkSXRlbXMpICYmIChcbiAgICAgICAgICAgICAgPFNvcnRhYmxlTGlzdCBpdGVtcz17aXRlbXNBcnJheX0ga2V5cz17a2V5c30gb25Tb3J0RW5kPXt0aGlzLm9uU29ydEVuZH0+XG4gICAgICAgICAgICAgICAge2l0ZW1zLm1hcCh0aGlzLnJlbmRlckl0ZW0pfVxuICAgICAgICAgICAgICA8L1NvcnRhYmxlTGlzdD5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICA8L0NsYXNzTmFtZXM+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcklucHV0KCkge1xuICAgIGNvbnN0IHsgZm9ySUQsIGNsYXNzTmFtZVdyYXBwZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIHJldHVybiAoXG4gICAgICA8aW5wdXRcbiAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfVxuICAgICAgICBvbkZvY3VzPXt0aGlzLmhhbmRsZUZvY3VzfVxuICAgICAgICBvbkJsdXI9e3RoaXMuaGFuZGxlQmx1cn1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVXcmFwcGVyfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJMaXN0Q29udHJvbCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJJbnB1dCgpO1xuICAgIH1cbiAgfVxufVxuIl19 */"))
  }, props.children);
}
function DragHandle({
  children,
  id
}) {
  const {
    attributes,
    listeners
  } = (0, _sortable.useSortable)({
    id
  });
  return (0, _core.jsx)("div", _extends({}, attributes, listeners), children);
}
const valueTypes = {
  SINGLE: 'SINGLE',
  MULTIPLE: 'MULTIPLE',
  MIXED: 'MIXED'
};
function handleSummary(summary, entry, label, item) {
  const data = _decapCmsLibWidgets.stringTemplate.addFileTemplateFields(entry.get('path'), item.set('fields.label', label));
  return _decapCmsLibWidgets.stringTemplate.compileStringTemplate(summary, null, '', data);
}
function validateItem(field, item) {
  if (!_immutable.Map.isMap(item)) {
    console.warn(`'${field.get('name')}' field item value value should be a map but is a '${typeof item}'`);
    return false;
  }
  return true;
}
function LabelComponent({
  field,
  isActive,
  hasErrors,
  uniqueFieldId,
  isFieldOptional,
  t
}) {
  const label = `${field.get('label', field.get('name'))}`;
  return (0, _core.jsx)(_decapCmsUiDefault.FieldLabel, {
    isActive: isActive,
    hasErrors: hasErrors,
    htmlFor: uniqueFieldId
  }, label, " ", `${isFieldOptional ? ` (${t('editor.editorControl.field.optional')})` : ''}`);
}
class ListControl extends _react.default.Component {
  constructor(props) {
    super(props);
    _defineProperty(this, "validations", []);
    _defineProperty(this, "valueToString", value => {
      let stringValue;
      if (_immutable.List.isList(value) || Array.isArray(value)) {
        stringValue = value.join(',');
      } else {
        console.warn(`Expected List value to be an array but received '${value}' with type of '${typeof value}'. Please check the value provided to the '${this.props.field.get('name')}' field`);
        stringValue = String(value);
      }
      return stringValue.replace(/,([^\s]|$)/g, ', $1');
    });
    _defineProperty(this, "getValueType", () => {
      const {
        field
      } = this.props;
      if (field.get('fields')) {
        return valueTypes.MULTIPLE;
      } else if (field.get('field')) {
        return valueTypes.SINGLE;
      } else if (field.get(_typedListHelpers.TYPES_KEY)) {
        return valueTypes.MIXED;
      } else {
        return null;
      }
    });
    _defineProperty(this, "uniqueFieldId", (0, _uniqueId2.default)(`${this.props.field.get('name')}-field-`));
    _defineProperty(this, "handleChange", e => {
      const {
        onChange
      } = this.props;
      const oldValue = this.state.value;
      const newValue = e.target.value.trim();
      const listValue = newValue ? newValue.split(',') : [];
      if (newValue.match(/,$/) && oldValue.match(/, $/)) {
        listValue.pop();
      }
      const parsedValue = this.valueToString(listValue);
      this.setState({
        value: parsedValue
      });
      onChange((0, _immutable.List)(listValue.map(val => val.trim())));
    });
    _defineProperty(this, "handleFocus", () => {
      this.props.setActiveStyle();
    });
    _defineProperty(this, "handleBlur", e => {
      const listValue = e.target.value.split(',').map(el => el.trim()).filter(el => el);
      this.setState({
        value: this.valueToString(listValue)
      });
      this.props.setInactiveStyle();
    });
    _defineProperty(this, "handleAdd", e => {
      e.preventDefault();
      const {
        field
      } = this.props;
      const parsedValue = this.getValueType() === valueTypes.SINGLE ? this.singleDefault() : (0, _immutable.fromJS)(this.multipleDefault(field.get('fields')));
      this.addItem(parsedValue);
    });
    _defineProperty(this, "singleDefault", () => {
      return this.props.field.getIn(['field', 'default'], null);
    });
    _defineProperty(this, "multipleDefault", fields => {
      return this.getFieldsDefault(fields);
    });
    _defineProperty(this, "handleAddType", (type, typeKey) => {
      const parsedValue = (0, _immutable.fromJS)(this.mixedDefault(typeKey, type));
      this.addItem(parsedValue);
    });
    _defineProperty(this, "mixedDefault", (typeKey, type) => {
      const selectedType = this.props.field.get(_typedListHelpers.TYPES_KEY).find(f => f.get('name') === type);
      const fields = selectedType.get('fields') || [selectedType.get('field')];
      return this.getFieldsDefault(fields, {
        [typeKey]: type
      });
    });
    _defineProperty(this, "getFieldsDefault", (fields, initialValue = {}) => {
      return fields.reduce((acc, item) => {
        const subfields = item.get('field') || item.get('fields');
        const object = item.get('widget') == 'object';
        const name = item.get('name');
        const defaultValue = item.get('default', null);
        if (_immutable.List.isList(subfields) && object) {
          const subDefaultValue = this.getFieldsDefault(subfields);
          !(0, _isEmpty2.default)(subDefaultValue) && (acc[name] = subDefaultValue);
          return acc;
        }
        if (_immutable.Map.isMap(subfields) && object) {
          const subDefaultValue = this.getFieldsDefault([subfields]);
          !(0, _isEmpty2.default)(subDefaultValue) && (acc[name] = subDefaultValue);
          return acc;
        }
        if (defaultValue !== null) {
          acc[name] = defaultValue;
        }
        return acc;
      }, initialValue);
    });
    _defineProperty(this, "addItem", parsedValue => {
      const {
        value,
        onChange,
        field
      } = this.props;
      const addToTop = field.get('add_to_top', false);
      const itemKey = (0, _v.default)();
      this.setState({
        itemsCollapsed: addToTop ? [false, ...this.state.itemsCollapsed] : [...this.state.itemsCollapsed, false],
        keys: addToTop ? [itemKey, ...this.state.keys] : [...this.state.keys, itemKey]
      });
      const listValue = value || (0, _immutable.List)();
      if (addToTop) {
        onChange(listValue.unshift(parsedValue));
      } else {
        onChange(listValue.push(parsedValue));
      }
    });
    _defineProperty(this, "processControlRef", ref => {
      if (!ref) return;
      const {
        validate,
        props: {
          validationKey: key
        }
      } = ref;
      this.validations.push({
        key,
        validate
      });
    });
    _defineProperty(this, "validate", () => {
      if (this.getValueType()) {
        this.validations.forEach(item => {
          item.validate();
        });
      } else {
        this.props.validate();
      }
      this.props.onValidateObject(this.props.forID, this.validateSize());
    });
    _defineProperty(this, "validateSize", () => {
      const {
        field,
        value,
        t
      } = this.props;
      const min = field.get('min');
      const max = field.get('max');
      const required = field.get('required', true);
      if (!required && !(value !== null && value !== void 0 && value.size)) {
        return [];
      }
      const error = _decapCmsLibWidgets.validations.validateMinMax(t, field.get('label', field.get('name')), value, min, max);
      return error ? [error] : [];
    });
    /**
     * In case the `onChangeObject` function is frozen by a child widget implementation,
     * e.g. when debounced, always get the latest object value instead of using
     * `this.props.value` directly.
     */
    _defineProperty(this, "getObjectValue", idx => this.props.value.get(idx) || (0, _immutable.Map)());
    _defineProperty(this, "handleRemove", (index, event) => {
      event.preventDefault();
      const {
        itemsCollapsed
      } = this.state;
      const {
        value,
        metadata,
        onChange,
        field,
        clearFieldErrors
      } = this.props;
      const collectionName = field.get('name');
      const isSingleField = this.getValueType() === valueTypes.SINGLE;
      const metadataRemovePath = isSingleField ? value.get(index) : value.get(index).valueSeq();
      const parsedMetadata = metadata && !metadata.isEmpty() ? {
        [collectionName]: metadata.removeIn(metadataRemovePath)
      } : metadata;
      itemsCollapsed.splice(index, 1);
      // clear validations
      this.validations = [];
      this.setState({
        itemsCollapsed: [...itemsCollapsed],
        keys: Array.from({
          length: value.size - 1
        }, () => (0, _v.default)())
      });
      onChange(value.remove(index), parsedMetadata);
      clearFieldErrors();
    });
    _defineProperty(this, "handleItemCollapseToggle", (index, event) => {
      event.preventDefault();
      const {
        itemsCollapsed
      } = this.state;
      const newItemsCollapsed = itemsCollapsed.map((collapsed, itemIndex) => {
        if (index === itemIndex) {
          return !collapsed;
        }
        return collapsed;
      });
      this.setState({
        itemsCollapsed: newItemsCollapsed
      });
    });
    _defineProperty(this, "handleCollapseAllToggle", e => {
      e.preventDefault();
      const {
        value,
        field
      } = this.props;
      const {
        itemsCollapsed,
        listCollapsed
      } = this.state;
      const minimizeCollapsedItems = field.get('minimize_collapsed', false);
      const listCollapsedByDefault = field.get('collapsed', true);
      const allItemsCollapsed = itemsCollapsed.every(val => val === true);
      if (minimizeCollapsedItems) {
        let updatedItemsCollapsed = itemsCollapsed;
        // Only allow collapsing all items in this mode but not opening all at once
        if (!listCollapsed || !listCollapsedByDefault) {
          updatedItemsCollapsed = Array(value.size).fill(!listCollapsed);
        }
        this.setState({
          listCollapsed: !listCollapsed,
          itemsCollapsed: updatedItemsCollapsed
        });
      } else {
        this.setState({
          itemsCollapsed: Array(value.size).fill(!allItemsCollapsed)
        });
      }
    });
    _defineProperty(this, "onSortEnd", ({
      oldIndex,
      newIndex
    }) => {
      const {
        value,
        clearFieldErrors
      } = this.props;
      const {
        itemsCollapsed,
        keys
      } = this.state;

      // Update value
      const item = value.get(oldIndex);
      const newValue = value.delete(oldIndex).insert(newIndex, item);
      this.props.onChange(newValue);

      // Update collapsing
      const collapsed = itemsCollapsed[oldIndex];
      itemsCollapsed.splice(oldIndex, 1);
      const updatedItemsCollapsed = [...itemsCollapsed];
      updatedItemsCollapsed.splice(newIndex, 0, collapsed);

      // Reset item to ensure updated state
      const updatedKeys = keys.map((key, keyIndex) => {
        if (keyIndex === oldIndex || keyIndex === newIndex) {
          return (0, _v.default)();
        }
        return key;
      });
      this.setState({
        itemsCollapsed: updatedItemsCollapsed,
        keys: updatedKeys
      });

      //clear error fields and remove old validations
      clearFieldErrors();
      this.validations = this.validations.filter(item => updatedKeys.includes(item.key));
    });
    _defineProperty(this, "hasError", index => {
      const {
        fieldsErrors
      } = this.props;
      if (fieldsErrors && fieldsErrors.size > 0) {
        return Object.values(fieldsErrors.toJS()).some(arr => arr.some(err => err.parentIds && err.parentIds.includes(this.state.keys[index])));
      }
    });
    // eslint-disable-next-line react/display-name
    _defineProperty(this, "renderItem", (item, index) => {
      const {
        classNameWrapper,
        editorControl,
        onValidateObject,
        metadata,
        clearFieldErrors,
        fieldsErrors,
        controlRef,
        resolveWidget,
        parentIds,
        forID,
        t
      } = this.props;
      const {
        itemsCollapsed,
        keys
      } = this.state;
      const collapsed = itemsCollapsed[index];
      const key = keys[index];
      let field = this.props.field;
      const hasError = this.hasError(index);
      const isVariableTypesList = this.getValueType() === valueTypes.MIXED;
      if (isVariableTypesList) {
        field = (0, _typedListHelpers.getTypedFieldForValue)(field, item);
        if (!field) {
          return this.renderErroneousTypedItem(index, item);
        }
      }
      console.log('kurwa', classNameWrapper);
      return (0, _core.jsx)(SortableListItem, {
        css: /*#__PURE__*/(0, _core.css)([styles.listControlItem, collapsed && styles.listControlItemCollapsed], ";label:ListControl;" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF1bEJRIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */")),
        index: index,
        key: key,
        id: key,
        keys: keys
      }, isVariableTypesList && (0, _core.jsx)(LabelComponent, {
        field: field,
        isActive: false,
        hasErrors: hasError,
        uniqueFieldId: this.uniqueFieldId,
        isFieldOptional: field.get('required') === false,
        t: t
      }), (0, _core.jsx)(StyledListItemTopBar, {
        collapsed: collapsed,
        onCollapseToggle: (0, _partial2.default)(this.handleItemCollapseToggle, index),
        dragHandle: DragHandle,
        id: key,
        onRemove: (0, _partial2.default)(this.handleRemove, index),
        "data-testid": `styled-list-item-top-bar-${key}`
      }), (0, _core.jsx)(NestedObjectLabel, {
        collapsed: collapsed,
        error: hasError
      }, this.objectLabel(item)), (0, _core.jsx)(_core.ClassNames, null, ({
        css,
        cx
      }) => (0, _core.jsx)(ObjectControl, {
        classNameWrapper: cx(classNameWrapper, {
          [css`
                  ${styleStrings.collapsedObjectControl};
                `]: collapsed
        }),
        value: item,
        field: field,
        onChangeObject: this.handleChangeFor(index),
        editorControl: editorControl,
        resolveWidget: resolveWidget,
        metadata: metadata,
        forList: true,
        onValidateObject: onValidateObject,
        clearFieldErrors: clearFieldErrors,
        fieldsErrors: fieldsErrors,
        ref: this.processControlRef,
        controlRef: controlRef,
        validationKey: key,
        collapsed: collapsed,
        "data-testid": `object-control-${key}`,
        hasError: hasError,
        parentIds: [...parentIds, forID, key]
      })));
    });
    const {
      field: _field,
      value: _value
    } = props;
    const _listCollapsed = _field.get('collapsed', true);
    const _itemsCollapsed = _value && Array(_value.size).fill(_listCollapsed) || [];
    const _keys = _value && Array.from({
      length: _value.size
    }, () => (0, _v.default)()) || [];
    this.state = {
      listCollapsed: _listCollapsed,
      itemsCollapsed: _itemsCollapsed,
      value: this.valueToString(_value),
      keys: _keys
    };
  }
  /**
   * Always update so that each nested widget has the option to update. This is
   * required because ControlHOC provides a default `shouldComponentUpdate`
   * which only updates if the value changes, but every widget must be allowed
   * to override this.
   */
  shouldComponentUpdate() {
    return true;
  }
  handleChangeFor(index) {
    return (f, newValue, newMetadata) => {
      const {
        value,
        metadata,
        onChange,
        field
      } = this.props;
      const collectionName = field.get('name');
      const listFieldObjectWidget = field.getIn(['field', 'widget']) === 'object';
      const withNameKey = this.getValueType() !== valueTypes.SINGLE || this.getValueType() === valueTypes.SINGLE && listFieldObjectWidget;
      const newObjectValue = withNameKey ? this.getObjectValue(index).set(f.get('name'), newValue) : newValue;
      const parsedMetadata = {
        [collectionName]: Object.assign(metadata ? metadata.toJS() : {}, newMetadata || {})
      };
      onChange(value.set(index, newObjectValue), parsedMetadata);
    };
  }
  objectLabel(item) {
    const {
      field,
      entry
    } = this.props;
    const valueType = this.getValueType();
    switch (valueType) {
      case valueTypes.MIXED:
        {
          if (!validateItem(field, item)) {
            return;
          }
          const itemType = (0, _typedListHelpers.getTypedFieldForValue)(field, item);
          const label = itemType.get('label', itemType.get('name'));
          // each type can have its own summary, but default to the list summary if exists
          const summary = itemType.get('summary', field.get('summary'));
          const labelReturn = summary ? handleSummary(summary, entry, label, item) : label;
          return labelReturn;
        }
      case valueTypes.SINGLE:
        {
          const singleField = field.get('field');
          const label = singleField.get('label', singleField.get('name'));
          const summary = field.get('summary');
          const data = (0, _immutable.fromJS)({
            [singleField.get('name')]: item
          });
          const labelReturn = summary ? handleSummary(summary, entry, label, data) : label;
          return labelReturn;
        }
      case valueTypes.MULTIPLE:
        {
          if (!validateItem(field, item)) {
            return;
          }
          const multiFields = field.get('fields');
          const labelField = multiFields && multiFields.first();
          const value = item.get(labelField.get('name'));
          const summary = field.get('summary');
          const labelReturn = summary ? handleSummary(summary, entry, value, item) : value;
          return (labelReturn || `No ${labelField.get('name')}`).toString();
        }
    }
    return '';
  }
  renderErroneousTypedItem(index, item) {
    const field = this.props.field;
    const errorMessage = (0, _typedListHelpers.getErrorMessageForTypedFieldAndValue)(field, item);
    const key = `item-${index}`;
    return (0, _core.jsx)(SortableListItem, {
      css: /*#__PURE__*/(0, _core.css)([styles.listControlItem, styles.listControlItemCollapsed], ";label:ListControl;" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3cEJRIiwiZmlsZSI6Ii4uLy4uL3NyYy9MaXN0Q29udHJvbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IEltbXV0YWJsZVByb3BUeXBlcyBmcm9tICdyZWFjdC1pbW11dGFibGUtcHJvcHR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnQGVtb3Rpb24vc3R5bGVkJztcbmltcG9ydCB7IGNzcywgQ2xhc3NOYW1lcyB9IGZyb20gJ0BlbW90aW9uL2NvcmUnO1xuaW1wb3J0IHsgTGlzdCwgTWFwLCBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgcGFydGlhbCwgaXNFbXB0eSwgdW5pcXVlSWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgRGVjYXBDbXNXaWRnZXRPYmplY3QgZnJvbSAnZGVjYXAtY21zLXdpZGdldC1vYmplY3QnO1xuaW1wb3J0IHtcbiAgRG5kQ29udGV4dCxcbiAgTW91c2VTZW5zb3IsXG4gIFRvdWNoU2Vuc29yLFxuICBjbG9zZXN0Q2VudGVyLFxuICB1c2VTZW5zb3IsXG4gIHVzZVNlbnNvcnMsXG59IGZyb20gJ0BkbmQta2l0L2NvcmUnO1xuaW1wb3J0IHsgU29ydGFibGVDb250ZXh0LCB1c2VTb3J0YWJsZSB9IGZyb20gJ0BkbmQta2l0L3NvcnRhYmxlJztcbmltcG9ydCB7IHJlc3RyaWN0VG9QYXJlbnRFbGVtZW50IH0gZnJvbSAnQGRuZC1raXQvbW9kaWZpZXJzJztcbmltcG9ydCB7IENTUyB9IGZyb20gJ0BkbmQta2l0L3V0aWxpdGllcyc7XG5pbXBvcnQge1xuICBMaXN0SXRlbVRvcEJhcixcbiAgT2JqZWN0V2lkZ2V0VG9wQmFyLFxuICBjb2xvcnMsXG4gIGxlbmd0aHMsXG4gIEZpZWxkTGFiZWwsXG59IGZyb20gJ2RlY2FwLWNtcy11aS1kZWZhdWx0JztcbmltcG9ydCB7IHN0cmluZ1RlbXBsYXRlLCB2YWxpZGF0aW9ucyB9IGZyb20gJ2RlY2FwLWNtcy1saWItd2lkZ2V0cyc7XG5cbmltcG9ydCB7XG4gIFRZUEVTX0tFWSxcbiAgZ2V0VHlwZWRGaWVsZEZvclZhbHVlLFxuICByZXNvbHZlRmllbGRLZXlUeXBlLFxuICBnZXRFcnJvck1lc3NhZ2VGb3JUeXBlZEZpZWxkQW5kVmFsdWUsXG59IGZyb20gJy4vdHlwZWRMaXN0SGVscGVycyc7XG5cbmNvbnN0IE9iamVjdENvbnRyb2wgPSBEZWNhcENtc1dpZGdldE9iamVjdC5jb250cm9sQ29tcG9uZW50O1xuXG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5kaXYoKTtcblxuY29uc3QgU3R5bGVkTGlzdEl0ZW1Ub3BCYXIgPSBzdHlsZWQoTGlzdEl0ZW1Ub3BCYXIpYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke2NvbG9ycy50ZXh0RmllbGRCb3JkZXJ9O1xuYDtcblxuY29uc3QgTmVzdGVkT2JqZWN0TGFiZWwgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiAke3Byb3BzID0+IChwcm9wcy5jb2xsYXBzZWQgPyAnYmxvY2snIDogJ25vbmUnKX07XG4gIGJvcmRlci10b3A6IDA7XG4gIGNvbG9yOiAke3Byb3BzID0+IChwcm9wcy5lcnJvciA/IGNvbG9ycy5lcnJvclRleHQgOiAnaW5oZXJpdCcpfTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtjb2xvcnMudGV4dEZpZWxkQm9yZGVyfTtcbiAgcGFkZGluZzogMTNweDtcbiAgYm9yZGVyLXJhZGl1czogMCAwICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9ICR7bGVuZ3Rocy5ib3JkZXJSYWRpdXN9O1xuYDtcblxuY29uc3Qgc3R5bGVTdHJpbmdzID0ge1xuICBjb2xsYXBzZWRPYmplY3RDb250cm9sOiBgXG4gICAgZGlzcGxheTogbm9uZTtcbiAgYCxcbiAgb2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyOiBgXG4gICAgcGFkZGluZzogJHtsZW5ndGhzLm9iamVjdFdpZGdldFRvcEJhckNvbnRhaW5lclBhZGRpbmd9O1xuICBgLFxufTtcblxuY29uc3Qgc3R5bGVzID0ge1xuICBsaXN0Q29udHJvbEl0ZW06IGNzc2BcbiAgICBtYXJnaW4tdG9wOiAxOHB4O1xuXG4gICAgJjpmaXJzdC1vZi10eXBlIHtcbiAgICAgIG1hcmdpbi10b3A6IDI2cHg7XG4gICAgfVxuICBgLFxuICBsaXN0Q29udHJvbEl0ZW1Db2xsYXBzZWQ6IGNzc2BcbiAgICBwYWRkaW5nLWJvdHRvbTogMDtcbiAgYCxcbn07XG5cbmZ1bmN0aW9uIFNvcnRhYmxlTGlzdCh7IGl0ZW1zLCBjaGlsZHJlbiwgb25Tb3J0RW5kLCBrZXlzIH0pIHtcbiAgY29uc3QgYWN0aXZhdGlvbkNvbnN0cmFpbnQgPSB7IGRpc3RhbmNlOiA0IH07XG4gIGNvbnN0IHNlbnNvcnMgPSB1c2VTZW5zb3JzKFxuICAgIHVzZVNlbnNvcihNb3VzZVNlbnNvciwgeyBhY3RpdmF0aW9uQ29uc3RyYWludCB9KSxcbiAgICB1c2VTZW5zb3IoVG91Y2hTZW5zb3IsIHsgYWN0aXZhdGlvbkNvbnN0cmFpbnQgfSksXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlU29ydEVuZCh7IGFjdGl2ZSwgb3ZlciB9KSB7XG4gICAgb25Tb3J0RW5kKHtcbiAgICAgIG9sZEluZGV4OiBrZXlzLmluZGV4T2YoYWN0aXZlLmlkKSxcbiAgICAgIG5ld0luZGV4OiBrZXlzLmluZGV4T2Yob3Zlci5pZCksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8RG5kQ29udGV4dFxuICAgICAgICBtb2RpZmllcnM9e1tyZXN0cmljdFRvUGFyZW50RWxlbWVudF19XG4gICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbj17Y2xvc2VzdENlbnRlcn1cbiAgICAgICAgc2Vuc29ycz17c2Vuc29yc31cbiAgICAgICAgb25EcmFnRW5kPXtoYW5kbGVTb3J0RW5kfVxuICAgICAgPlxuICAgICAgICA8U29ydGFibGVDb250ZXh0IGl0ZW1zPXtpdGVtc30+e2NoaWxkcmVufTwvU29ydGFibGVDb250ZXh0PlxuICAgICAgPC9EbmRDb250ZXh0PlxuICAgIDwvZGl2PlxuICApO1xufVxuXG5mdW5jdGlvbiBTb3J0YWJsZUxpc3RJdGVtKHByb3BzKSB7XG4gIGNvbnN0IHsgc2V0Tm9kZVJlZiwgdHJhbnNmb3JtLCB0cmFuc2l0aW9uIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQ6IHByb3BzLmlkLFxuICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHtcbiAgICB0cmFuc2Zvcm06IENTUy5UcmFuc2Zvcm0udG9TdHJpbmcodHJhbnNmb3JtKSxcbiAgICB0cmFuc2l0aW9uLFxuICB9O1xuXG4gIGNvbnN0IHsgY29sbGFwc2VkIH0gPSBwcm9wcztcblxuICByZXR1cm4gKFxuICAgIDxMaXN0SXRlbVxuICAgICAgc29ydGFibGVcbiAgICAgIHJlZj17c2V0Tm9kZVJlZn1cbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNzcz17W3N0eWxlcy5saXN0Q29udHJvbEl0ZW0sIGNvbGxhcHNlZCAmJiBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICA+XG4gICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgPC9MaXN0SXRlbT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gRHJhZ0hhbmRsZSh7IGNoaWxkcmVuLCBpZCB9KSB7XG4gIGNvbnN0IHsgYXR0cmlidXRlcywgbGlzdGVuZXJzIH0gPSB1c2VTb3J0YWJsZSh7XG4gICAgaWQsXG4gIH0pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiB7Li4uYXR0cmlidXRlc30gey4uLmxpc3RlbmVyc30+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbmNvbnN0IHZhbHVlVHlwZXMgPSB7XG4gIFNJTkdMRTogJ1NJTkdMRScsXG4gIE1VTFRJUExFOiAnTVVMVElQTEUnLFxuICBNSVhFRDogJ01JWEVEJyxcbn07XG5cbmZ1bmN0aW9uIGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIGxhYmVsLCBpdGVtKSB7XG4gIGNvbnN0IGRhdGEgPSBzdHJpbmdUZW1wbGF0ZS5hZGRGaWxlVGVtcGxhdGVGaWVsZHMoXG4gICAgZW50cnkuZ2V0KCdwYXRoJyksXG4gICAgaXRlbS5zZXQoJ2ZpZWxkcy5sYWJlbCcsIGxhYmVsKSxcbiAgKTtcbiAgcmV0dXJuIHN0cmluZ1RlbXBsYXRlLmNvbXBpbGVTdHJpbmdUZW1wbGF0ZShzdW1tYXJ5LCBudWxsLCAnJywgZGF0YSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlSXRlbShmaWVsZCwgaXRlbSkge1xuICBpZiAoIU1hcC5pc01hcChpdGVtKSkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgIGAnJHtmaWVsZC5nZXQoJ25hbWUnKX0nIGZpZWxkIGl0ZW0gdmFsdWUgdmFsdWUgc2hvdWxkIGJlIGEgbWFwIGJ1dCBpcyBhICcke3R5cGVvZiBpdGVtfSdgLFxuICAgICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBMYWJlbENvbXBvbmVudCh7IGZpZWxkLCBpc0FjdGl2ZSwgaGFzRXJyb3JzLCB1bmlxdWVGaWVsZElkLCBpc0ZpZWxkT3B0aW9uYWwsIHQgfSkge1xuICBjb25zdCBsYWJlbCA9IGAke2ZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSl9YDtcbiAgcmV0dXJuIChcbiAgICA8RmllbGRMYWJlbCBpc0FjdGl2ZT17aXNBY3RpdmV9IGhhc0Vycm9ycz17aGFzRXJyb3JzfSBodG1sRm9yPXt1bmlxdWVGaWVsZElkfT5cbiAgICAgIHtsYWJlbH0ge2Ake2lzRmllbGRPcHRpb25hbCA/IGAgKCR7dCgnZWRpdG9yLmVkaXRvckNvbnRyb2wuZmllbGQub3B0aW9uYWwnKX0pYCA6ICcnfWB9XG4gICAgPC9GaWVsZExhYmVsPlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHZhbGlkYXRpb25zID0gW107XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBtZXRhZGF0YTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZU9iamVjdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblZhbGlkYXRlT2JqZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbGlkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBJbW11dGFibGVQcm9wVHlwZXMubGlzdCxcbiAgICBmaWVsZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JJRDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250cm9sUmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBtZWRpYVBhdGhzOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuTWVkaWFMaWJyYXJ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25SZW1vdmVJbnNlcnRlZE1lZGlhOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZVdyYXBwZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXRBY3RpdmVTdHlsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRJbmFjdGl2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGVkaXRvckNvbnRyb2w6IFByb3BUeXBlcy5lbGVtZW50VHlwZS5pc1JlcXVpcmVkLFxuICAgIHJlc29sdmVXaWRnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXJGaWVsZEVycm9yczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBmaWVsZHNFcnJvcnM6IEltbXV0YWJsZVByb3BUeXBlcy5tYXAuaXNSZXF1aXJlZCxcbiAgICBlbnRyeTogSW1tdXRhYmxlUHJvcFR5cGVzLm1hcC5pc1JlcXVpcmVkLFxuICAgIHQ6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdmFsdWU6IExpc3QoKSxcbiAgICBwYXJlbnRJZHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlIH0gPSBwcm9wcztcbiAgICBjb25zdCBsaXN0Q29sbGFwc2VkID0gZmllbGQuZ2V0KCdjb2xsYXBzZWQnLCB0cnVlKTtcbiAgICBjb25zdCBpdGVtc0NvbGxhcHNlZCA9ICh2YWx1ZSAmJiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKGxpc3RDb2xsYXBzZWQpKSB8fCBbXTtcbiAgICBjb25zdCBrZXlzID0gKHZhbHVlICYmIEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgfSwgKCkgPT4gdXVpZCgpKSkgfHwgW107XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGlzdENvbGxhcHNlZCxcbiAgICAgIGl0ZW1zQ29sbGFwc2VkLFxuICAgICAgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyh2YWx1ZSksXG4gICAgICBrZXlzLFxuICAgIH07XG4gIH1cblxuICB2YWx1ZVRvU3RyaW5nID0gdmFsdWUgPT4ge1xuICAgIGxldCBzdHJpbmdWYWx1ZTtcbiAgICBpZiAoTGlzdC5pc0xpc3QodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBzdHJpbmdWYWx1ZSA9IHZhbHVlLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRXhwZWN0ZWQgTGlzdCB2YWx1ZSB0byBiZSBhbiBhcnJheSBidXQgcmVjZWl2ZWQgJyR7dmFsdWV9JyB3aXRoIHR5cGUgb2YgJyR7dHlwZW9mIHZhbHVlfScuIFBsZWFzZSBjaGVjayB0aGUgdmFsdWUgcHJvdmlkZWQgdG8gdGhlICcke3RoaXMucHJvcHMuZmllbGQuZ2V0KFxuICAgICAgICAgICduYW1lJyxcbiAgICAgICAgKX0nIGZpZWxkYCxcbiAgICAgICk7XG4gICAgICBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdWYWx1ZS5yZXBsYWNlKC8sKFteXFxzXXwkKS9nLCAnLCAkMScpO1xuICB9O1xuXG4gIGdldFZhbHVlVHlwZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmaWVsZC5nZXQoJ2ZpZWxkcycpKSB7XG4gICAgICByZXR1cm4gdmFsdWVUeXBlcy5NVUxUSVBMRTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLmdldCgnZmllbGQnKSkge1xuICAgICAgcmV0dXJuIHZhbHVlVHlwZXMuU0lOR0xFO1xuICAgIH0gZWxzZSBpZiAoZmllbGQuZ2V0KFRZUEVTX0tFWSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVR5cGVzLk1JWEVEO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdW5pcXVlRmllbGRJZCA9IHVuaXF1ZUlkKGAke3RoaXMucHJvcHMuZmllbGQuZ2V0KCduYW1lJyl9LWZpZWxkLWApO1xuICAvKipcbiAgICogQWx3YXlzIHVwZGF0ZSBzbyB0aGF0IGVhY2ggbmVzdGVkIHdpZGdldCBoYXMgdGhlIG9wdGlvbiB0byB1cGRhdGUuIFRoaXMgaXNcbiAgICogcmVxdWlyZWQgYmVjYXVzZSBDb250cm9sSE9DIHByb3ZpZGVzIGEgZGVmYXVsdCBgc2hvdWxkQ29tcG9uZW50VXBkYXRlYFxuICAgKiB3aGljaCBvbmx5IHVwZGF0ZXMgaWYgdGhlIHZhbHVlIGNoYW5nZXMsIGJ1dCBldmVyeSB3aWRnZXQgbXVzdCBiZSBhbGxvd2VkXG4gICAqIHRvIG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSBlID0+IHtcbiAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCBsaXN0VmFsdWUgPSBuZXdWYWx1ZSA/IG5ld1ZhbHVlLnNwbGl0KCcsJykgOiBbXTtcbiAgICBpZiAobmV3VmFsdWUubWF0Y2goLywkLykgJiYgb2xkVmFsdWUubWF0Y2goLywgJC8pKSB7XG4gICAgICBsaXN0VmFsdWUucG9wKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSB0aGlzLnZhbHVlVG9TdHJpbmcobGlzdFZhbHVlKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHBhcnNlZFZhbHVlIH0pO1xuICAgIG9uQ2hhbmdlKExpc3QobGlzdFZhbHVlLm1hcCh2YWwgPT4gdmFsLnRyaW0oKSkpKTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLnNldEFjdGl2ZVN0eWxlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IGUgPT4ge1xuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChlbCA9PiBlbC50cmltKCkpXG4gICAgICAuZmlsdGVyKGVsID0+IGVsKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IHRoaXMudmFsdWVUb1N0cmluZyhsaXN0VmFsdWUpIH0pO1xuICAgIHRoaXMucHJvcHMuc2V0SW5hY3RpdmVTdHlsZSgpO1xuICB9O1xuXG4gIGhhbmRsZUFkZCA9IGUgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHBhcnNlZFZhbHVlID1cbiAgICAgIHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFXG4gICAgICAgID8gdGhpcy5zaW5nbGVEZWZhdWx0KClcbiAgICAgICAgOiBmcm9tSlModGhpcy5tdWx0aXBsZURlZmF1bHQoZmllbGQuZ2V0KCdmaWVsZHMnKSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgc2luZ2xlRGVmYXVsdCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5maWVsZC5nZXRJbihbJ2ZpZWxkJywgJ2RlZmF1bHQnXSwgbnVsbCk7XG4gIH07XG5cbiAgbXVsdGlwbGVEZWZhdWx0ID0gZmllbGRzID0+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcyk7XG4gIH07XG5cbiAgaGFuZGxlQWRkVHlwZSA9ICh0eXBlLCB0eXBlS2V5KSA9PiB7XG4gICAgY29uc3QgcGFyc2VkVmFsdWUgPSBmcm9tSlModGhpcy5taXhlZERlZmF1bHQodHlwZUtleSwgdHlwZSkpO1xuICAgIHRoaXMuYWRkSXRlbShwYXJzZWRWYWx1ZSk7XG4gIH07XG5cbiAgbWl4ZWREZWZhdWx0ID0gKHR5cGVLZXksIHR5cGUpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZFR5cGUgPSB0aGlzLnByb3BzLmZpZWxkLmdldChUWVBFU19LRVkpLmZpbmQoZiA9PiBmLmdldCgnbmFtZScpID09PSB0eXBlKTtcbiAgICBjb25zdCBmaWVsZHMgPSBzZWxlY3RlZFR5cGUuZ2V0KCdmaWVsZHMnKSB8fCBbc2VsZWN0ZWRUeXBlLmdldCgnZmllbGQnKV07XG5cbiAgICByZXR1cm4gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KGZpZWxkcywgeyBbdHlwZUtleV06IHR5cGUgfSk7XG4gIH07XG5cbiAgZ2V0RmllbGRzRGVmYXVsdCA9IChmaWVsZHMsIGluaXRpYWxWYWx1ZSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgY29uc3Qgc3ViZmllbGRzID0gaXRlbS5nZXQoJ2ZpZWxkJykgfHwgaXRlbS5nZXQoJ2ZpZWxkcycpO1xuICAgICAgY29uc3Qgb2JqZWN0ID0gaXRlbS5nZXQoJ3dpZGdldCcpID09ICdvYmplY3QnO1xuICAgICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0KCduYW1lJyk7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpdGVtLmdldCgnZGVmYXVsdCcsIG51bGwpO1xuXG4gICAgICBpZiAoTGlzdC5pc0xpc3Qoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KHN1YmZpZWxkcyk7XG4gICAgICAgICFpc0VtcHR5KHN1YkRlZmF1bHRWYWx1ZSkgJiYgKGFjY1tuYW1lXSA9IHN1YkRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG5cbiAgICAgIGlmIChNYXAuaXNNYXAoc3ViZmllbGRzKSAmJiBvYmplY3QpIHtcbiAgICAgICAgY29uc3Qgc3ViRGVmYXVsdFZhbHVlID0gdGhpcy5nZXRGaWVsZHNEZWZhdWx0KFtzdWJmaWVsZHNdKTtcbiAgICAgICAgIWlzRW1wdHkoc3ViRGVmYXVsdFZhbHVlKSAmJiAoYWNjW25hbWVdID0gc3ViRGVmYXVsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBhY2NbbmFtZV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBhZGRJdGVtID0gcGFyc2VkVmFsdWUgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUsIG9uQ2hhbmdlLCBmaWVsZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBhZGRUb1RvcCA9IGZpZWxkLmdldCgnYWRkX3RvX3RvcCcsIGZhbHNlKTtcblxuICAgIGNvbnN0IGl0ZW1LZXkgPSB1dWlkKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogYWRkVG9Ub3BcbiAgICAgICAgPyBbZmFsc2UsIC4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWRdXG4gICAgICAgIDogWy4uLnRoaXMuc3RhdGUuaXRlbXNDb2xsYXBzZWQsIGZhbHNlXSxcbiAgICAgIGtleXM6IGFkZFRvVG9wID8gW2l0ZW1LZXksIC4uLnRoaXMuc3RhdGUua2V5c10gOiBbLi4udGhpcy5zdGF0ZS5rZXlzLCBpdGVtS2V5XSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGxpc3RWYWx1ZSA9IHZhbHVlIHx8IExpc3QoKTtcbiAgICBpZiAoYWRkVG9Ub3ApIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS51bnNoaWZ0KHBhcnNlZFZhbHVlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9uQ2hhbmdlKGxpc3RWYWx1ZS5wdXNoKHBhcnNlZFZhbHVlKSk7XG4gICAgfVxuICB9O1xuXG4gIHByb2Nlc3NDb250cm9sUmVmID0gcmVmID0+IHtcbiAgICBpZiAoIXJlZikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIHZhbGlkYXRlLFxuICAgICAgcHJvcHM6IHsgdmFsaWRhdGlvbktleToga2V5IH0sXG4gICAgfSA9IHJlZjtcbiAgICB0aGlzLnZhbGlkYXRpb25zLnB1c2goeyBrZXksIHZhbGlkYXRlIH0pO1xuICB9O1xuXG4gIHZhbGlkYXRlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmdldFZhbHVlVHlwZSgpKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0udmFsaWRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLnZhbGlkYXRlKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZU9iamVjdCh0aGlzLnByb3BzLmZvcklELCB0aGlzLnZhbGlkYXRlU2l6ZSgpKTtcbiAgfTtcblxuICB2YWxpZGF0ZVNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBmaWVsZCwgdmFsdWUsIHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWluID0gZmllbGQuZ2V0KCdtaW4nKTtcbiAgICBjb25zdCBtYXggPSBmaWVsZC5nZXQoJ21heCcpO1xuICAgIGNvbnN0IHJlcXVpcmVkID0gZmllbGQuZ2V0KCdyZXF1aXJlZCcsIHRydWUpO1xuXG4gICAgaWYgKCFyZXF1aXJlZCAmJiAhdmFsdWU/LnNpemUpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvciA9IHZhbGlkYXRpb25zLnZhbGlkYXRlTWluTWF4KFxuICAgICAgdCxcbiAgICAgIGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSksXG4gICAgICB2YWx1ZSxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICApO1xuXG4gICAgcmV0dXJuIGVycm9yID8gW2Vycm9yXSA6IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBgb25DaGFuZ2VPYmplY3RgIGZ1bmN0aW9uIGlzIGZyb3plbiBieSBhIGNoaWxkIHdpZGdldCBpbXBsZW1lbnRhdGlvbixcbiAgICogZS5nLiB3aGVuIGRlYm91bmNlZCwgYWx3YXlzIGdldCB0aGUgbGF0ZXN0IG9iamVjdCB2YWx1ZSBpbnN0ZWFkIG9mIHVzaW5nXG4gICAqIGB0aGlzLnByb3BzLnZhbHVlYCBkaXJlY3RseS5cbiAgICovXG4gIGdldE9iamVjdFZhbHVlID0gaWR4ID0+IHRoaXMucHJvcHMudmFsdWUuZ2V0KGlkeCkgfHwgTWFwKCk7XG5cbiAgaGFuZGxlQ2hhbmdlRm9yKGluZGV4KSB7XG4gICAgcmV0dXJuIChmLCBuZXdWYWx1ZSwgbmV3TWV0YWRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdmFsdWUsIG1ldGFkYXRhLCBvbkNoYW5nZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZSA9IGZpZWxkLmdldCgnbmFtZScpO1xuICAgICAgY29uc3QgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0ID0gZmllbGQuZ2V0SW4oWydmaWVsZCcsICd3aWRnZXQnXSkgPT09ICdvYmplY3QnO1xuICAgICAgY29uc3Qgd2l0aE5hbWVLZXkgPVxuICAgICAgICB0aGlzLmdldFZhbHVlVHlwZSgpICE9PSB2YWx1ZVR5cGVzLlNJTkdMRSB8fFxuICAgICAgICAodGhpcy5nZXRWYWx1ZVR5cGUoKSA9PT0gdmFsdWVUeXBlcy5TSU5HTEUgJiYgbGlzdEZpZWxkT2JqZWN0V2lkZ2V0KTtcbiAgICAgIGNvbnN0IG5ld09iamVjdFZhbHVlID0gd2l0aE5hbWVLZXlcbiAgICAgICAgPyB0aGlzLmdldE9iamVjdFZhbHVlKGluZGV4KS5zZXQoZi5nZXQoJ25hbWUnKSwgbmV3VmFsdWUpXG4gICAgICAgIDogbmV3VmFsdWU7XG4gICAgICBjb25zdCBwYXJzZWRNZXRhZGF0YSA9IHtcbiAgICAgICAgW2NvbGxlY3Rpb25OYW1lXTogT2JqZWN0LmFzc2lnbihtZXRhZGF0YSA/IG1ldGFkYXRhLnRvSlMoKSA6IHt9LCBuZXdNZXRhZGF0YSB8fCB7fSksXG4gICAgICB9O1xuICAgICAgb25DaGFuZ2UodmFsdWUuc2V0KGluZGV4LCBuZXdPYmplY3RWYWx1ZSksIHBhcnNlZE1ldGFkYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgaGFuZGxlUmVtb3ZlID0gKGluZGV4LCBldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHZhbHVlLCBtZXRhZGF0YSwgb25DaGFuZ2UsIGZpZWxkLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lID0gZmllbGQuZ2V0KCduYW1lJyk7XG4gICAgY29uc3QgaXNTaW5nbGVGaWVsZCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuU0lOR0xFO1xuXG4gICAgY29uc3QgbWV0YWRhdGFSZW1vdmVQYXRoID0gaXNTaW5nbGVGaWVsZCA/IHZhbHVlLmdldChpbmRleCkgOiB2YWx1ZS5nZXQoaW5kZXgpLnZhbHVlU2VxKCk7XG4gICAgY29uc3QgcGFyc2VkTWV0YWRhdGEgPVxuICAgICAgbWV0YWRhdGEgJiYgIW1ldGFkYXRhLmlzRW1wdHkoKVxuICAgICAgICA/IHsgW2NvbGxlY3Rpb25OYW1lXTogbWV0YWRhdGEucmVtb3ZlSW4obWV0YWRhdGFSZW1vdmVQYXRoKSB9XG4gICAgICAgIDogbWV0YWRhdGE7XG5cbiAgICBpdGVtc0NvbGxhcHNlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIGNsZWFyIHZhbGlkYXRpb25zXG4gICAgdGhpcy52YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogWy4uLml0ZW1zQ29sbGFwc2VkXSxcbiAgICAgIGtleXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IHZhbHVlLnNpemUgLSAxIH0sICgpID0+IHV1aWQoKSksXG4gICAgfSk7XG5cbiAgICBvbkNoYW5nZSh2YWx1ZS5yZW1vdmUoaW5kZXgpLCBwYXJzZWRNZXRhZGF0YSk7XG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICB9O1xuXG4gIGhhbmRsZUl0ZW1Db2xsYXBzZVRvZ2dsZSA9IChpbmRleCwgZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbmV3SXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5tYXAoKGNvbGxhcHNlZCwgaXRlbUluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IGl0ZW1JbmRleCkge1xuICAgICAgICByZXR1cm4gIWNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xsYXBzZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpdGVtc0NvbGxhcHNlZDogbmV3SXRlbXNDb2xsYXBzZWQsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGUgPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBpdGVtc0NvbGxhcHNlZCwgbGlzdENvbGxhcHNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zID0gZmllbGQuZ2V0KCdtaW5pbWl6ZV9jb2xsYXBzZWQnLCBmYWxzZSk7XG4gICAgY29uc3QgbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCA9IGZpZWxkLmdldCgnY29sbGFwc2VkJywgdHJ1ZSk7XG4gICAgY29uc3QgYWxsSXRlbXNDb2xsYXBzZWQgPSBpdGVtc0NvbGxhcHNlZC5ldmVyeSh2YWwgPT4gdmFsID09PSB0cnVlKTtcblxuICAgIGlmIChtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSB7XG4gICAgICBsZXQgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQ7XG4gICAgICAvLyBPbmx5IGFsbG93IGNvbGxhcHNpbmcgYWxsIGl0ZW1zIGluIHRoaXMgbW9kZSBidXQgbm90IG9wZW5pbmcgYWxsIGF0IG9uY2VcbiAgICAgIGlmICghbGlzdENvbGxhcHNlZCB8fCAhbGlzdENvbGxhcHNlZEJ5RGVmYXVsdCkge1xuICAgICAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQgPSBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFsaXN0Q29sbGFwc2VkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0Q29sbGFwc2VkOiAhbGlzdENvbGxhcHNlZCwgaXRlbXNDb2xsYXBzZWQ6IHVwZGF0ZWRJdGVtc0NvbGxhcHNlZCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGl0ZW1zQ29sbGFwc2VkOiBBcnJheSh2YWx1ZS5zaXplKS5maWxsKCFhbGxJdGVtc0NvbGxhcHNlZCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIG9iamVjdExhYmVsKGl0ZW0pIHtcbiAgICBjb25zdCB7IGZpZWxkLCBlbnRyeSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSB0aGlzLmdldFZhbHVlVHlwZSgpO1xuICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICBjYXNlIHZhbHVlVHlwZXMuTUlYRUQ6IHtcbiAgICAgICAgaWYgKCF2YWxpZGF0ZUl0ZW0oZmllbGQsIGl0ZW0pKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW1UeXBlID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBpdGVtVHlwZS5nZXQoJ2xhYmVsJywgaXRlbVR5cGUuZ2V0KCduYW1lJykpO1xuICAgICAgICAvLyBlYWNoIHR5cGUgY2FuIGhhdmUgaXRzIG93biBzdW1tYXJ5LCBidXQgZGVmYXVsdCB0byB0aGUgbGlzdCBzdW1tYXJ5IGlmIGV4aXN0c1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gaXRlbVR5cGUuZ2V0KCdzdW1tYXJ5JywgZmllbGQuZ2V0KCdzdW1tYXJ5JykpO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgaXRlbSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLlNJTkdMRToge1xuICAgICAgICBjb25zdCBzaW5nbGVGaWVsZCA9IGZpZWxkLmdldCgnZmllbGQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzaW5nbGVGaWVsZC5nZXQoJ2xhYmVsJywgc2luZ2xlRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcm9tSlMoeyBbc2luZ2xlRmllbGQuZ2V0KCduYW1lJyldOiBpdGVtIH0pO1xuICAgICAgICBjb25zdCBsYWJlbFJldHVybiA9IHN1bW1hcnkgPyBoYW5kbGVTdW1tYXJ5KHN1bW1hcnksIGVudHJ5LCBsYWJlbCwgZGF0YSkgOiBsYWJlbDtcbiAgICAgICAgcmV0dXJuIGxhYmVsUmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSB2YWx1ZVR5cGVzLk1VTFRJUExFOiB7XG4gICAgICAgIGlmICghdmFsaWRhdGVJdGVtKGZpZWxkLCBpdGVtKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtdWx0aUZpZWxkcyA9IGZpZWxkLmdldCgnZmllbGRzJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsRmllbGQgPSBtdWx0aUZpZWxkcyAmJiBtdWx0aUZpZWxkcy5maXJzdCgpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0KGxhYmVsRmllbGQuZ2V0KCduYW1lJykpO1xuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZmllbGQuZ2V0KCdzdW1tYXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsUmV0dXJuID0gc3VtbWFyeSA/IGhhbmRsZVN1bW1hcnkoc3VtbWFyeSwgZW50cnksIHZhbHVlLCBpdGVtKSA6IHZhbHVlO1xuICAgICAgICByZXR1cm4gKGxhYmVsUmV0dXJuIHx8IGBObyAke2xhYmVsRmllbGQuZ2V0KCduYW1lJyl9YCkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgb25Tb3J0RW5kID0gKHsgb2xkSW5kZXgsIG5ld0luZGV4IH0pID0+IHtcbiAgICBjb25zdCB7IHZhbHVlLCBjbGVhckZpZWxkRXJyb3JzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXNDb2xsYXBzZWQsIGtleXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAvLyBVcGRhdGUgdmFsdWVcbiAgICBjb25zdCBpdGVtID0gdmFsdWUuZ2V0KG9sZEluZGV4KTtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlLmRlbGV0ZShvbGRJbmRleCkuaW5zZXJ0KG5ld0luZGV4LCBpdGVtKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcblxuICAgIC8vIFVwZGF0ZSBjb2xsYXBzaW5nXG4gICAgY29uc3QgY29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWRbb2xkSW5kZXhdO1xuICAgIGl0ZW1zQ29sbGFwc2VkLnNwbGljZShvbGRJbmRleCwgMSk7XG4gICAgY29uc3QgdXBkYXRlZEl0ZW1zQ29sbGFwc2VkID0gWy4uLml0ZW1zQ29sbGFwc2VkXTtcbiAgICB1cGRhdGVkSXRlbXNDb2xsYXBzZWQuc3BsaWNlKG5ld0luZGV4LCAwLCBjb2xsYXBzZWQpO1xuXG4gICAgLy8gUmVzZXQgaXRlbSB0byBlbnN1cmUgdXBkYXRlZCBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZWRLZXlzID0ga2V5cy5tYXAoKGtleSwga2V5SW5kZXgpID0+IHtcbiAgICAgIGlmIChrZXlJbmRleCA9PT0gb2xkSW5kZXggfHwga2V5SW5kZXggPT09IG5ld0luZGV4KSB7XG4gICAgICAgIHJldHVybiB1dWlkKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2V5O1xuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpdGVtc0NvbGxhcHNlZDogdXBkYXRlZEl0ZW1zQ29sbGFwc2VkLCBrZXlzOiB1cGRhdGVkS2V5cyB9KTtcblxuICAgIC8vY2xlYXIgZXJyb3IgZmllbGRzIGFuZCByZW1vdmUgb2xkIHZhbGlkYXRpb25zXG4gICAgY2xlYXJGaWVsZEVycm9ycygpO1xuICAgIHRoaXMudmFsaWRhdGlvbnMgPSB0aGlzLnZhbGlkYXRpb25zLmZpbHRlcihpdGVtID0+IHVwZGF0ZWRLZXlzLmluY2x1ZGVzKGl0ZW0ua2V5KSk7XG4gIH07XG5cbiAgaGFzRXJyb3IgPSBpbmRleCA9PiB7XG4gICAgY29uc3QgeyBmaWVsZHNFcnJvcnMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGZpZWxkc0Vycm9ycyAmJiBmaWVsZHNFcnJvcnMuc2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkc0Vycm9ycy50b0pTKCkpLnNvbWUoYXJyID0+XG4gICAgICAgIGFyci5zb21lKGVyciA9PiBlcnIucGFyZW50SWRzICYmIGVyci5wYXJlbnRJZHMuaW5jbHVkZXModGhpcy5zdGF0ZS5rZXlzW2luZGV4XSkpLFxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2Rpc3BsYXktbmFtZVxuICByZW5kZXJJdGVtID0gKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lV3JhcHBlcixcbiAgICAgIGVkaXRvckNvbnRyb2wsXG4gICAgICBvblZhbGlkYXRlT2JqZWN0LFxuICAgICAgbWV0YWRhdGEsXG4gICAgICBjbGVhckZpZWxkRXJyb3JzLFxuICAgICAgZmllbGRzRXJyb3JzLFxuICAgICAgY29udHJvbFJlZixcbiAgICAgIHJlc29sdmVXaWRnZXQsXG4gICAgICBwYXJlbnRJZHMsXG4gICAgICBmb3JJRCxcbiAgICAgIHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbGxhcHNlZCA9IGl0ZW1zQ29sbGFwc2VkW2luZGV4XTtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2luZGV4XTtcbiAgICBsZXQgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gdGhpcy5oYXNFcnJvcihpbmRleCk7XG4gICAgY29uc3QgaXNWYXJpYWJsZVR5cGVzTGlzdCA9IHRoaXMuZ2V0VmFsdWVUeXBlKCkgPT09IHZhbHVlVHlwZXMuTUlYRUQ7XG4gICAgaWYgKGlzVmFyaWFibGVUeXBlc0xpc3QpIHtcbiAgICAgIGZpZWxkID0gZ2V0VHlwZWRGaWVsZEZvclZhbHVlKGZpZWxkLCBpdGVtKTtcbiAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygna3Vyd2EnLCBjbGFzc05hbWVXcmFwcGVyKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBjb2xsYXBzZWQgJiYgc3R5bGVzLmxpc3RDb250cm9sSXRlbUNvbGxhcHNlZF19XG4gICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAga2V5PXtrZXl9XG4gICAgICAgIGlkPXtrZXl9XG4gICAgICAgIGtleXM9e2tleXN9XG4gICAgICA+XG4gICAgICAgIHtpc1ZhcmlhYmxlVHlwZXNMaXN0ICYmIChcbiAgICAgICAgICA8TGFiZWxDb21wb25lbnRcbiAgICAgICAgICAgIGZpZWxkPXtmaWVsZH1cbiAgICAgICAgICAgIGlzQWN0aXZlPXtmYWxzZX1cbiAgICAgICAgICAgIGhhc0Vycm9ycz17aGFzRXJyb3J9XG4gICAgICAgICAgICB1bmlxdWVGaWVsZElkPXt0aGlzLnVuaXF1ZUZpZWxkSWR9XG4gICAgICAgICAgICBpc0ZpZWxkT3B0aW9uYWw9e2ZpZWxkLmdldCgncmVxdWlyZWQnKSA9PT0gZmFsc2V9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxTdHlsZWRMaXN0SXRlbVRvcEJhclxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3BhcnRpYWwodGhpcy5oYW5kbGVJdGVtQ29sbGFwc2VUb2dnbGUsIGluZGV4KX1cbiAgICAgICAgICBkcmFnSGFuZGxlPXtEcmFnSGFuZGxlfVxuICAgICAgICAgIGlkPXtrZXl9XG4gICAgICAgICAgb25SZW1vdmU9e3BhcnRpYWwodGhpcy5oYW5kbGVSZW1vdmUsIGluZGV4KX1cbiAgICAgICAgICBkYXRhLXRlc3RpZD17YHN0eWxlZC1saXN0LWl0ZW0tdG9wLWJhci0ke2tleX1gfVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXtjb2xsYXBzZWR9IGVycm9yPXtoYXNFcnJvcn0+XG4gICAgICAgICAge3RoaXMub2JqZWN0TGFiZWwoaXRlbSl9XG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICAgIDxDbGFzc05hbWVzPlxuICAgICAgICAgIHsoeyBjc3MsIGN4IH0pID0+IChcbiAgICAgICAgICAgIDxPYmplY3RDb250cm9sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVdyYXBwZXI9e2N4KGNsYXNzTmFtZVdyYXBwZXIsIHtcbiAgICAgICAgICAgICAgICBbY3NzYFxuICAgICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3MuY29sbGFwc2VkT2JqZWN0Q29udHJvbH07XG4gICAgICAgICAgICAgICAgYF06IGNvbGxhcHNlZCxcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIHZhbHVlPXtpdGVtfVxuICAgICAgICAgICAgICBmaWVsZD17ZmllbGR9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlT2JqZWN0PXt0aGlzLmhhbmRsZUNoYW5nZUZvcihpbmRleCl9XG4gICAgICAgICAgICAgIGVkaXRvckNvbnRyb2w9e2VkaXRvckNvbnRyb2x9XG4gICAgICAgICAgICAgIHJlc29sdmVXaWRnZXQ9e3Jlc29sdmVXaWRnZXR9XG4gICAgICAgICAgICAgIG1ldGFkYXRhPXttZXRhZGF0YX1cbiAgICAgICAgICAgICAgZm9yTGlzdFxuICAgICAgICAgICAgICBvblZhbGlkYXRlT2JqZWN0PXtvblZhbGlkYXRlT2JqZWN0fVxuICAgICAgICAgICAgICBjbGVhckZpZWxkRXJyb3JzPXtjbGVhckZpZWxkRXJyb3JzfVxuICAgICAgICAgICAgICBmaWVsZHNFcnJvcnM9e2ZpZWxkc0Vycm9yc31cbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnByb2Nlc3NDb250cm9sUmVmfVxuICAgICAgICAgICAgICBjb250cm9sUmVmPXtjb250cm9sUmVmfVxuICAgICAgICAgICAgICB2YWxpZGF0aW9uS2V5PXtrZXl9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YG9iamVjdC1jb250cm9sLSR7a2V5fWB9XG4gICAgICAgICAgICAgIGhhc0Vycm9yPXtoYXNFcnJvcn1cbiAgICAgICAgICAgICAgcGFyZW50SWRzPXtbLi4ucGFyZW50SWRzLCBmb3JJRCwga2V5XX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9DbGFzc05hbWVzPlxuICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyRXJyb25lb3VzVHlwZWRJdGVtKGluZGV4LCBpdGVtKSB7XG4gICAgY29uc3QgZmllbGQgPSB0aGlzLnByb3BzLmZpZWxkO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVycm9yTWVzc2FnZUZvclR5cGVkRmllbGRBbmRWYWx1ZShmaWVsZCwgaXRlbSk7XG4gICAgY29uc3Qga2V5ID0gYGl0ZW0tJHtpbmRleH1gO1xuICAgIHJldHVybiAoXG4gICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICBjc3M9e1tzdHlsZXMubGlzdENvbnRyb2xJdGVtLCBzdHlsZXMubGlzdENvbnRyb2xJdGVtQ29sbGFwc2VkXX1cbiAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICBrZXk9e2tleX1cbiAgICAgID5cbiAgICAgICAgPFN0eWxlZExpc3RJdGVtVG9wQmFyXG4gICAgICAgICAgb25Db2xsYXBzZVRvZ2dsZT17bnVsbH1cbiAgICAgICAgICBvblJlbW92ZT17cGFydGlhbCh0aGlzLmhhbmRsZVJlbW92ZSwgaW5kZXgsIGtleSl9XG4gICAgICAgICAgZHJhZ0hhbmRsZT17RHJhZ0hhbmRsZX1cbiAgICAgICAgICBpZD17a2V5fVxuICAgICAgICAvPlxuICAgICAgICA8TmVzdGVkT2JqZWN0TGFiZWwgY29sbGFwc2VkPXt0cnVlfSBlcnJvcj17dHJ1ZX0+XG4gICAgICAgICAge2Vycm9yTWVzc2FnZX1hYWFhc2RkXG4gICAgICAgIDwvTmVzdGVkT2JqZWN0TGFiZWw+XG4gICAgICA8L1NvcnRhYmxlTGlzdEl0ZW0+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxpc3RDb250cm9sKCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcklELCBmaWVsZCwgY2xhc3NOYW1lV3JhcHBlciwgdCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGl0ZW1zQ29sbGFwc2VkLCBsaXN0Q29sbGFwc2VkLCBrZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUgfHwgTGlzdCgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuZ2V0KCdsYWJlbCcsIGZpZWxkLmdldCgnbmFtZScpKTtcbiAgICBjb25zdCBsYWJlbFNpbmd1bGFyID0gZmllbGQuZ2V0KCdsYWJlbF9zaW5ndWxhcicpIHx8IGZpZWxkLmdldCgnbGFiZWwnLCBmaWVsZC5nZXQoJ25hbWUnKSk7XG4gICAgY29uc3QgbGlzdExhYmVsID0gaXRlbXMuc2l6ZSA9PT0gMSA/IGxhYmVsU2luZ3VsYXIudG9Mb3dlckNhc2UoKSA6IGxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgbWluaW1pemVDb2xsYXBzZWRJdGVtcyA9IGZpZWxkLmdldCgnbWluaW1pemVfY29sbGFwc2VkJywgZmFsc2UpO1xuICAgIGNvbnN0IGFsbEl0ZW1zQ29sbGFwc2VkID0gaXRlbXNDb2xsYXBzZWQuZXZlcnkodmFsID0+IHZhbCA9PT0gdHJ1ZSk7XG4gICAgY29uc3Qgc2VsZkNvbGxhcHNlZCA9IGFsbEl0ZW1zQ29sbGFwc2VkICYmIChsaXN0Q29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKTtcblxuICAgIGNvbnN0IGl0ZW1zQXJyYXkgPSBrZXlzLm1hcChrZXkgPT4gKHsgaWQ6IGtleSB9KSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENsYXNzTmFtZXM+XG4gICAgICAgIHsoeyBjeCwgY3NzIH0pID0+IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17Zm9ySUR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICAgICBjbGFzc05hbWVXcmFwcGVyLFxuICAgICAgICAgICAgICBjc3NgXG4gICAgICAgICAgICAgICAgJHtzdHlsZVN0cmluZ3Mub2JqZWN0V2lkZ2V0VG9wQmFyQ29udGFpbmVyfVxuICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8T2JqZWN0V2lkZ2V0VG9wQmFyXG4gICAgICAgICAgICAgIGFsbG93QWRkPXtmaWVsZC5nZXQoJ2FsbG93X2FkZCcsIHRydWUpfVxuICAgICAgICAgICAgICBvbkFkZD17dGhpcy5oYW5kbGVBZGR9XG4gICAgICAgICAgICAgIHR5cGVzPXtmaWVsZC5nZXQoVFlQRVNfS0VZLCBudWxsKX1cbiAgICAgICAgICAgICAgb25BZGRUeXBlPXt0eXBlID0+IHRoaXMuaGFuZGxlQWRkVHlwZSh0eXBlLCByZXNvbHZlRmllbGRLZXlUeXBlKGZpZWxkKSl9XG4gICAgICAgICAgICAgIGhlYWRpbmc9e2Ake2l0ZW1zLnNpemV9ICR7bGlzdExhYmVsfWB9XG4gICAgICAgICAgICAgIGxhYmVsPXtsYWJlbFNpbmd1bGFyLnRvTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgIG9uQ29sbGFwc2VUb2dnbGU9e3RoaXMuaGFuZGxlQ29sbGFwc2VBbGxUb2dnbGV9XG4gICAgICAgICAgICAgIGNvbGxhcHNlZD17c2VsZkNvbGxhcHNlZH1cbiAgICAgICAgICAgICAgdD17dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7KCFzZWxmQ29sbGFwc2VkIHx8ICFtaW5pbWl6ZUNvbGxhcHNlZEl0ZW1zKSAmJiAoXG4gICAgICAgICAgICAgIDxTb3J0YWJsZUxpc3QgaXRlbXM9e2l0ZW1zQXJyYXl9IGtleXM9e2tleXN9IG9uU29ydEVuZD17dGhpcy5vblNvcnRFbmR9PlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAodGhpcy5yZW5kZXJJdGVtKX1cbiAgICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9DbGFzc05hbWVzPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IGZvcklELCBjbGFzc05hbWVXcmFwcGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgaWQ9e2ZvcklEfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c31cbiAgICAgICAgb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lV3JhcHBlcn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5nZXRWYWx1ZVR5cGUoKSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGlzdENvbnRyb2woKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5wdXQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ== */")),
      index: index,
      key: key
    }, (0, _core.jsx)(StyledListItemTopBar, {
      onCollapseToggle: null,
      onRemove: (0, _partial2.default)(this.handleRemove, index, key),
      dragHandle: DragHandle,
      id: key
    }), (0, _core.jsx)(NestedObjectLabel, {
      collapsed: true,
      error: true
    }, errorMessage, "aaaasdd"));
  }
  renderListControl() {
    const {
      value,
      forID,
      field,
      classNameWrapper,
      t
    } = this.props;
    const {
      itemsCollapsed,
      listCollapsed,
      keys
    } = this.state;
    const items = value || (0, _immutable.List)();
    const label = field.get('label', field.get('name'));
    const labelSingular = field.get('label_singular') || field.get('label', field.get('name'));
    const listLabel = items.size === 1 ? labelSingular.toLowerCase() : label.toLowerCase();
    const minimizeCollapsedItems = field.get('minimize_collapsed', false);
    const allItemsCollapsed = itemsCollapsed.every(val => val === true);
    const selfCollapsed = allItemsCollapsed && (listCollapsed || !minimizeCollapsedItems);
    const itemsArray = keys.map(key => ({
      id: key
    }));
    return (0, _core.jsx)(_core.ClassNames, null, ({
      cx,
      css
    }) => (0, _core.jsx)("div", {
      id: forID,
      className: cx(classNameWrapper, css`
                ${styleStrings.objectWidgetTopBarContainer}
              `)
    }, (0, _core.jsx)(_decapCmsUiDefault.ObjectWidgetTopBar, {
      allowAdd: field.get('allow_add', true),
      onAdd: this.handleAdd,
      types: field.get(_typedListHelpers.TYPES_KEY, null),
      onAddType: type => this.handleAddType(type, (0, _typedListHelpers.resolveFieldKeyType)(field)),
      heading: `${items.size} ${listLabel}`,
      label: labelSingular.toLowerCase(),
      onCollapseToggle: this.handleCollapseAllToggle,
      collapsed: selfCollapsed,
      t: t
    }), (!selfCollapsed || !minimizeCollapsedItems) && (0, _core.jsx)(SortableList, {
      items: itemsArray,
      keys: keys,
      onSortEnd: this.onSortEnd
    }, items.map(this.renderItem))));
  }
  renderInput() {
    const {
      forID,
      classNameWrapper
    } = this.props;
    const {
      value
    } = this.state;
    return (0, _core.jsx)("input", {
      type: "text",
      id: forID,
      value: value,
      onChange: this.handleChange,
      onFocus: this.handleFocus,
      onBlur: this.handleBlur,
      className: classNameWrapper
    });
  }
  render() {
    if (this.getValueType() !== null) {
      return this.renderListControl();
    } else {
      return this.renderInput();
    }
  }
}
exports.default = ListControl;
_defineProperty(ListControl, "propTypes", {
  metadata: _reactImmutableProptypes.default.map,
  onChange: _propTypes.default.func.isRequired,
  onChangeObject: _propTypes.default.func.isRequired,
  onValidateObject: _propTypes.default.func.isRequired,
  validate: _propTypes.default.func.isRequired,
  value: _reactImmutableProptypes.default.list,
  field: _propTypes.default.object,
  forID: _propTypes.default.string,
  controlRef: _propTypes.default.func,
  mediaPaths: _reactImmutableProptypes.default.map.isRequired,
  getAsset: _propTypes.default.func.isRequired,
  onOpenMediaLibrary: _propTypes.default.func.isRequired,
  onAddAsset: _propTypes.default.func.isRequired,
  onRemoveInsertedMedia: _propTypes.default.func.isRequired,
  classNameWrapper: _propTypes.default.string.isRequired,
  setActiveStyle: _propTypes.default.func.isRequired,
  setInactiveStyle: _propTypes.default.func.isRequired,
  editorControl: _propTypes.default.elementType.isRequired,
  resolveWidget: _propTypes.default.func.isRequired,
  clearFieldErrors: _propTypes.default.func.isRequired,
  fieldsErrors: _reactImmutableProptypes.default.map.isRequired,
  entry: _reactImmutableProptypes.default.map.isRequired,
  t: _propTypes.default.func
});
_defineProperty(ListControl, "defaultProps", {
  value: (0, _immutable.List)(),
  parentIds: []
});